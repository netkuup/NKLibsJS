var Big,DP=20,RM=1,MAX_DP=1e6,MAX_POWER=1e6,NE=-7,PE=21,STRICT=!1,NAME="[big.js] ",INVALID=NAME+"Invalid ",INVALID_DP=INVALID+"decimal places",INVALID_RM=INVALID+"rounding mode",DIV_BY_ZERO=NAME+"Division by zero",P={},UNDEFINED=void 0,NUMERIC=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _Big_(){function r(e){var t=this;if(!(t instanceof r))return e===UNDEFINED?_Big_():new r(e);if(e instanceof r)t.s=e.s,t.e=e.e,t.c=e.c.slice();else{if("string"!=typeof e){if(!0===r.strict&&"bigint"!=typeof e)throw TypeError(INVALID+"value");e=0===e&&1/e<0?"-0":String(e)}parse(t,e)}t.constructor=r}return r.prototype=P,r.DP=DP,r.RM=RM,r.NE=NE,r.PE=PE,r.strict=STRICT,r.roundDown=0,r.roundHalfUp=1,r.roundHalfEven=2,r.roundUp=3,r}function parse(e,t){var r,n,i;if(!NUMERIC.test(t))throw Error(INVALID+"number");for(e.s="-"==t.charAt(0)?(t=t.slice(1),-1):1,0<(n=(t=-1<(r=t.indexOf("."))?t.replace(".",""):t).search(/e/i))?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),i=t.length,n=0;n<i&&"0"==t.charAt(n);)++n;if(n==i)e.c=[e.e=0];else{for(;0<i&&"0"==t.charAt(--i););for(e.e=r-n-1,e.c=[],r=0;n<=i;)e.c[r++]=+t.charAt(n++)}return e}function round(e,t,r,n){var i=e.c;if(0!==(r=r===UNDEFINED?e.constructor.RM:r)&&1!==r&&2!==r&&3!==r)throw Error(INVALID_RM);if(t<1)n=3===r&&(n||!!i[0])||0===t&&(1===r&&5<=i[0]||2===r&&(5<i[0]||5===i[0]&&(n||i[1]!==UNDEFINED))),i.length=1,n?(e.e=e.e-t+1,i[0]=1):i[0]=e.e=0;else if(t<i.length){if(n=1===r&&5<=i[t]||2===r&&(5<i[t]||5===i[t]&&(n||i[t+1]!==UNDEFINED||1&i[t-1]))||3===r&&(n||!!i[0]),i.length=t,n)for(;9<++i[--t];)if((i[t]=0)===t){++e.e,i.unshift(1);break}for(t=i.length;!i[--t];)i.pop()}return e}function stringify(e,t,r){var n=e.e,i=e.c.join(""),o=i.length;if(t)i=i.charAt(0)+(1<o?"."+i.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)i="0"+i;i="0."+i}else if(0<n)if(++n>o)for(n-=o;n--;)i+="0";else n<o&&(i=i.slice(0,n)+"."+i.slice(n));else 1<o&&(i=i.charAt(0)+"."+i.slice(1));return e.s<0&&r?"-"+i:i}P.abs=function(){var e=new this.constructor(this);return e.s=1,e},P.cmp=function(e){var t,r=this,n=r.c,i=(e=new r.constructor(e)).c,o=r.s,s=e.s,r=r.e,e=e.e;if(!n[0]||!i[0])return n[0]?o:i[0]?-s:0;if(o!=s)return o;if(t=o<0,r!=e)return e<r^t?1:-1;for(s=(r=n.length)<(e=i.length)?r:e,o=-1;++o<s;)if(n[o]!=i[o])return n[o]>i[o]^t?1:-1;return r==e?0:e<r^t?1:-1},P.div=function(e){var t=this,r=t.constructor,n=t.c,i=(e=new r(e)).c,o=t.s==e.s?1:-1,s=r.DP;if(s!==~~s||s<0||MAX_DP<s)throw Error(INVALID_DP);if(!i[0])throw Error(DIV_BY_ZERO);if(!n[0])return e.s=o,e.c=[e.e=0],e;var a,l,c,u,d,h=i.slice(),f=a=i.length,p=n.length,N=n.slice(0,a),m=N.length,g=e,K=g.c=[],_=0,s=s+(g.e=t.e-e.e)+1;for(g.s=o,o=s<0?0:s,h.unshift(0);m++<a;)N.push(0);do{for(c=0;c<10;c++){if(a!=(m=N.length))u=m<a?1:-1;else for(d=-1,u=0;++d<a;)if(i[d]!=N[d]){u=i[d]>N[d]?1:-1;break}if(!(u<0))break;for(l=m==a?i:h;m;){if(N[--m]<l[m]){for(d=m;d&&!N[--d];)N[d]=9;--N[d],N[m]+=10}N[m]-=l[m]}for(;!N[0];)N.shift()}}while(K[_++]=u?c:++c,N[0]&&u?N[m]=n[f]||0:N=[n[f]],(f++<p||N[0]!==UNDEFINED)&&o--);return K[0]||1==_||(K.shift(),g.e--,s--),s<_&&round(g,s,r.RM,N[0]!==UNDEFINED),g},P.eq=function(e){return 0===this.cmp(e)},P.gt=function(e){return 0<this.cmp(e)},P.gte=function(e){return-1<this.cmp(e)},P.lt=function(e){return this.cmp(e)<0},P.lte=function(e){return this.cmp(e)<1},P.minus=P.sub=function(e){var t,r,n,i,o=this,s=o.constructor,a=o.s,l=(e=new s(e)).s;if(a!=l)return e.s=-l,o.plus(e);var c=o.c.slice(),u=o.e,d=e.c,h=e.e;if(c[0]&&d[0]){if(a=u-h){for((n=(i=a<0)?(a=-a,c):(h=u,d)).reverse(),l=a;l--;)n.push(0);n.reverse()}else for(r=((i=c.length<d.length)?c:d).length,a=l=0;l<r;l++)if(c[l]!=d[l]){i=c[l]<d[l];break}if(i&&(n=c,c=d,d=n,e.s=-e.s),0<(l=(r=d.length)-(t=c.length)))for(;l--;)c[t++]=0;for(l=t;a<r;){if(c[--r]<d[r]){for(t=r;t&&!c[--t];)c[t]=9;--c[t],c[r]+=10}c[r]-=d[r]}for(;0===c[--l];)c.pop();for(;0===c[0];)c.shift(),--h;c[0]||(e.s=1,c=[h=0]),e.c=c,e.e=h}else d[0]?e.s=-l:c[0]?e=new s(o):e.s=1;return e},P.mod=function(e){var t,r=this,n=r.constructor,i=r.s,o=(e=new n(e)).s;if(e.c[0])return t=(r.s=e.s=1)==e.cmp(r),r.s=i,e.s=o,t?new n(r):(i=n.DP,o=n.RM,n.DP=n.RM=0,r=r.div(e),n.DP=i,n.RM=o,this.minus(r.times(e)));throw Error(DIV_BY_ZERO)},P.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e},P.plus=P.add=function(e){var t,r,n,i=this,o=i.constructor;if(e=new o(e),i.s!=e.s)return e.s=-e.s,i.minus(e);var s=i.e,a=i.c,l=e.e,c=e.c;if(a[0]&&c[0]){if(a=a.slice(),t=s-l){for((n=0<t?(l=s,c):(t=-t,a)).reverse();t--;)n.push(0);n.reverse()}for(a.length-c.length<0&&(n=c,c=a,a=n),t=c.length,r=0;t;a[t]%=10)r=(a[--t]=a[t]+c[t]+r)/10|0;for(r&&(a.unshift(r),++l),t=a.length;0===a[--t];)a.pop();e.c=a,e.e=l}else c[0]||(a[0]?e=new o(i):e.s=i.s);return e},P.pow=function(e){var t=this,r=new t.constructor("1"),n=r,i=e<0;if(e!==~~e||e<-MAX_POWER||MAX_POWER<e)throw Error(INVALID+"exponent");for(i&&(e=-e);1&e&&(n=n.times(t)),e>>=1;)t=t.times(t);return i?r.div(n):n},P.prec=function(e,t){if(e!==~~e||e<1||MAX_DP<e)throw Error(INVALID+"precision");return round(new this.constructor(this),e,t)},P.round=function(e,t){if(e===UNDEFINED)e=0;else if(e!==~~e||e<-MAX_DP||MAX_DP<e)throw Error(INVALID_DP);return round(new this.constructor(this),e+this.e+1,t)},P.sqrt=function(){var e,t,r,n=this,i=n.constructor,o=n.s,s=n.e,a=new i("0.5");if(!n.c[0])return new i(n);if(o<0)throw Error(NAME+"No square root");for(s=(e=0===(o=Math.sqrt(n+""))||o===1/0?((t=n.c.join("")).length+s&1||(t+="0"),s=((s+1)/2|0)-(s<0||1&s),new i(((o=Math.sqrt(t))==1/0?"5e":(o=o.toExponential()).slice(0,o.indexOf("e")+1))+s)):new i(o+"")).e+(i.DP+=4);r=e,e=a.times(r.plus(n.div(r))),r.c.slice(0,s).join("")!==e.c.slice(0,s).join(""););return round(e,(i.DP-=4)+e.e+1,i.RM)},P.times=P.mul=function(e){var t,r=this.constructor,n=this.c,i=(e=new r(e)).c,o=n.length,s=i.length,a=this.e,l=e.e;if(e.s=this.s==e.s?1:-1,n[0]&&i[0]){for(e.e=a+l,o<s&&(t=n,n=i,i=t,l=o,o=s,s=l),t=new Array(l=o+s);l--;)t[l]=0;for(a=s;a--;){for(s=0,l=o+a;a<l;)s=t[l]+i[a]*n[l-a-1]+s,t[l--]=s%10,s=s/10|0;t[l]=s}for(s?++e.e:t.shift(),a=t.length;!t[--a];)t.pop();e.c=t}else e.c=[e.e=0];return e},P.toExponential=function(e,t){var r=this,n=r.c[0];if(e!==UNDEFINED){if(e!==~~e||e<0||MAX_DP<e)throw Error(INVALID_DP);for(r=round(new r.constructor(r),++e,t);r.c.length<e;)r.c.push(0)}return stringify(r,!0,!!n)},P.toFixed=function(e,t){var r=this,n=r.c[0];if(e!==UNDEFINED){if(e!==~~e||e<0||MAX_DP<e)throw Error(INVALID_DP);for(e=e+(r=round(new r.constructor(r),e+r.e+1,t)).e+1;r.c.length<e;)r.c.push(0)}return stringify(r,!1,!!n)},P.toJSON=P.toString=function(){var e=this,t=e.constructor;return stringify(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])},P.toNumber=function(){var e=Number(stringify(this,!0,!0));if(!0!==this.constructor.strict||this.eq(e.toString()))return e;throw Error(NAME+"Imprecise conversion")},P.toPrecision=function(e,t){var r=this,n=r.constructor,i=r.c[0];if(e!==UNDEFINED){if(e!==~~e||e<1||MAX_DP<e)throw Error(INVALID+"precision");for(r=round(new n(r),e,t);r.c.length<e;)r.c.push(0)}return stringify(r,e<=r.e||r.e<=n.NE||r.e>=n.PE,!!i)},P.valueOf=function(){var e=this.constructor;if(!0===e.strict)throw Error(NAME+"valueOf disallowed");return stringify(this,this.e<=e.NE||this.e>=e.PE,!0)},Big=_Big_(),Big.default=Big.Big=Big,"function"==typeof define&&define.amd?define(function(){return Big}):"undefined"!=typeof module&&module.exports&&(module.exports=Big);var NK={};function NKEventListener(){this.events={},this.addEventListener=function(e,t){NK.isset(this.events[e])||(this.events[e]=[]),this.events[e].push(t)},this.removeEventListener=function(e,t){for(var r=0;r<this.events[e].length;r++)if(this.events[e][r]===t){this.events[e].splice(r,1);break}},this.dispatchEvent=function(e,t){if(NK.isset(this.events[e]))for(var r=0;r<this.events[e].length;r++)(0,this.events[e][r])(t)}}NK.isset=function(e){if(void 0===e)return!1;if(null==e)return!1;if("function"==typeof e)try{e()}catch(e){return!1}return!0},NK.issetAll=function(e){for(var t=0;t<e.length;t++)if(!NK.isset(e[t]))return!1;return!0},NK.empty=function(e){return!NK.isset(e)||("function"==typeof e?0===e().length:0===e.length)},NK.var=function(e,t){return NK.isset(e)?e:t},NK.clone=function(e){return console.error("NK.clone() deprecated, use NKObject.clone() instead."),JSON.parse(JSON.stringify(e))},NK.backtrace=function(e=""){var t=(new Error).stack.split("\n").slice(2).join("\n");console.log("Backtrace: "+e+"\n"+t)},NK.getScriptPath=function(){var e=document.querySelectorAll("script"),e=e[e.length-1].src;return e.substring(8,e.lastIndexOf("/"))},NK.sleep=function(t,e=!1){if(!e)return new Promise(e=>{setTimeout(e,t)});for(var r=(new Date).getTime();(new Date).getTime()-r<t;);},NK.core={},NK.core.reloadOnDomChange=function(e){NK.isset(NK.core.reactableModules)||(NK.core.reactableModules=[]),NK.core.reactableModules.push(e),NK.isset(NK.core.MutationObserver)||(MutationObserver=window.MutationObserver||window.WebKitMutationObserver,NK.core.MutationObserverOffset=1,NK.core.MutationObserver=new MutationObserver(function(e,t){if(0<NK.core.MutationObserverOffset)NK.core.MutationObserverOffset--;else for(var r=0;r<NK.core.reactableModules.length;r++)void 0!==NK.core.reactableModules[r].reload&&NK.core.reactableModules[r].reload()}),NK.core.MutationObserver.observe(document,{subtree:!0,childList:!0}))},NK.core.ignoreMutations=function(e){NK.isset(NK.core.MutationObserver)&&(NK.core.MutationObserverOffset+=e)},window.addEventListener("load",function(){if(!NK.isset(()=>window.$))throw"Error, you must include jquery before using NKLibsJS";window.loaded=!0}),Number.prototype.nksum=function(e){return new Big(this).add(e).toNumber()},Number.prototype.nkadd=function(e){return new Big(this).add(e).toNumber()},Number.prototype.nkminus=function(e){return new Big(this).minus(e).toNumber()},Number.prototype.nksubtract=function(e){return new Big(this).minus(e).toNumber()},Number.prototype.nkdiv=function(e){return new Big(this).div(e).toNumber()},Number.prototype.nkmul=function(e){return new Big(this).mul(e).toNumber()},Number.prototype.nkpow=function(e){return new Big(this).pow(e).toNumber()},Number.prototype.nkmod=function(e){return new Big(this).mod(e).toNumber()},Number.prototype.nkprec=function(e){return new Big(this).prec(e).toNumber()},Number.prototype.nkround=function(e){return new Big(this).round(e).toNumber()},Number.prototype.nkfixed=Number.prototype.nkround,Number.prototype.nktruncate=function(e){return Number((this+"").slice(0,(this+"").indexOf(".")+e+1))},Number.prototype.nksqrt=function(){return new Big(this).sqrt().toNumber()},Number.prototype.nkabs=function(){return Math.abs(this)};var NKActions={};if(void 0===NK)throw"You must include base.js before actions.js";NKActions.start=function(e){NK.isset(NKActions.loaded)&&!0===NKActions.loaded||(window.addEventListener("load",NKActions.reload),!0===window.loaded&&NKActions.reload(),!0===e&&NK.core.reloadOnDomChange(NKActions),NKActions.loaded=!0)},NKActions.reload=function(){function t(e,t){var r=$(e).html();0<(r=r.toLowerCase().startsWith("hide")||r.toLowerCase().startsWith("show")?r.substring(4):r).length&&!r.startsWith(" ")&&(r=" "+r),t.is(":visible")?$(e).html("Hide"+r):$(e).html("Show"+r),console.log("entra")}$(".NKHide_btn").off().on("click",function(){$(this).closest(".NKHide_dst").hide()}),$(".NKDel_btn").off().on("click",function(){$(this).closest(".NKDel_dst").remove()}),$(".NKToggle_btn").off().on("click",function(){var e=$(this).siblings(".NKToggle_dst");e.toggle(),$(this).hasClass("NKReact")&&t(this,e)}),$(".NKToggle_btn.NKReact").each(function(){t(this,$(this).siblings(".NKToggle_dst"))})};let NKArray={};function NKCanvas(e=null){if(this.canvas=null,this.ctx=null,this.w=0,this.h=0,null===e)this.canvas=document.createElement("canvas");else if(e instanceof HTMLCanvasElement)this.canvas=e;else{if("string"!=typeof e)return void console.error("NKCanvas invalid argument.");this.canvas=document.getElementById(e)}this.canvas.style.imageRendering="pixelated",this.ctx=this.canvas.getContext("2d"),this.w=this.canvas.width,this.h=this.canvas.height}NKArray.clone=function(e){return JSON.parse(JSON.stringify(e))},NKArray.getCombinations=function(){if("string"!=typeof arguments[0])return console.error("First argument must be a string."),[];let i=arguments[0];var t=[];for(let e=1;e<arguments.length;e++){if(!Array.isArray(arguments[e]))return console.error("One of the parameters is not an array."),[];t.push(arguments[e])}function e(e,n){return e.reduce(function(e,t,r){return""+e+n[r][t]+i},"")}var r=new Array(t.length).fill(0),n=[];let o=e(r,t);for(n.push(o.slice(0,-1));function(t,r){for(let e=t.length-1;0<=e;e--){var n=r[e].length-1;if(t[e]+1<=n)return t[e]++,1;if(e-1<0)return;t[e]=0}}(r,t);)o=e(r,t),n.push(o.slice(0,-1));return n},NKArray.mountTree=function(t,r,n,i){var o={},s=[];for(let e=0;e<t.length;e++)void 0===o[t[e][r]]&&(o[t[e][r]]={},o[t[e][r]][i]=[]),void 0===o[t[e][n]]&&(o[t[e][n]]={},o[t[e][n]][i]=[]),o[t[e][r]]={...t[e],...o[t[e][r]]},(0===parseInt(t[e][n])?s:o[t[e][n]][i]).push(o[t[e][r]]);return s},NKCanvas.prototype.setSize=function(e=400,t=200){this.canvas.width=e,this.canvas.height=t,this.w=e,this.h=t},NKCanvas.prototype.clean=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},NKCanvas.prototype.getPixelColor=function(e=0,t=0){var r=this.ctx.getImageData(0,0,this.w,this.h,{willReadFrequently:!0}).data,t=this.w.nkmul(t).nksum(e).nkmul(4);return{rgba:[r[t],r[t+1],r[t+2],r[t+3]]}},NKCanvas.prototype.searchPixelCoords=function(t=[0,0,0]){var r=this.ctx.getImageData(0,0,this.w,this.h).data;let n=-1;for(let e=0;e<r.length;e+=4)if(r[e]===t[0]&&r[e+1]===t[1]&&r[e+2]===t[2]){n=e;break}var e=n.nkdiv(4),i=Math.floor(e.nkdiv(this.w));return{x:e%this.w,y:i}},NKCanvas.prototype.extractPortion=function(e,t,r,n,i={}){var o=document.createElement("canvas"),i=o.getContext("2d",i);return o.hidden=!0,o.width=r,o.height=n,i.drawImage(this.canvas,e,t,r,n,0,0,r,n),o},NKCanvas.prototype.replaceColor=function(t,r){var e=this.ctx.getImageData(0,0,this.w,this.h),n=e.data;let i=0;if(4===t.length&&4===r.length)for(let e=0;e<n.length;e+=4)n[e]===t[0]&&n[e+1]===t[1]&&n[e+2]===t[2]&&n[e+3]===t[3]&&(n[e]=r[0],n[e+1]=r[1],n[e+2]=r[2],n[e+3]=r[3],i++);else for(let e=0;e<n.length;e+=4)n[e]===t[0]&&n[e+1]===t[1]&&n[e+2]===t[2]&&(n[e]=r[0],n[e+1]=r[1],n[e+2]=r[2],i++);return this.ctx.putImageData(e,0,0),i},NKCanvas.prototype.compare=function(e){var t=this.ctx,r=e.getContext("2d");if(this.h!==e.width||this.h!==e.height)return console.error("Los canvas tienen dimensiones diferentes.");var e=t.getImageData(0,0,this.w,this.h),t=r.getImageData(0,0,this.w,this.h),n=e.data,i=t.data,o=[];for(let e=0;e<n.length;e+=4){var s,a,l=n.slice(e,e+4),c=i.slice(e,e+4);a=c,(s=l)[0]===a[0]&&s[1]===a[1]&&s[2]===a[2]&&s[3]===a[3]||(s=e/4%this.w,a=Math.floor(e/4/this.w),o.push({x:s,y:a,color_1:l,color_2:c}))}return o},NKCanvas.prototype.drawRect=function(e){var t=NK.var(e.border_px,0),r=NK.var(e.x,0),n=NK.var(e.y,0);let i=NK.var(e.w,0),o=NK.var(e.h,0);e.x&&e.x2&&(i=e.x2.nkminus(e.x).nksum(2*t)),e.y&&e.y2&&(o=e.y2.nkminus(e.y).nksum(2*t)),NK.isset(e.color)&&(this.ctx.fillStyle=e.color),NK.isset(e.border_px)&&(this.ctx.lineWidth=e.border_px),NK.isset(e.border_color)&&(this.ctx.strokeStyle=e.border_color),NK.isset(e.border_pattern)&&this.ctx.setLineDash(e.border_pattern),NK.isset(e.color)&&this.ctx.fillRect(r+t,n+t,i,o),(NK.isset(e.border_color)||NK.isset(e.border_px)&&0<e.border_px)&&this.ctx.strokeRect(r+t,n+t,i,o)},NKCanvas.prototype.drawCircle=function(e){var t=NK.var(e.r,NK.var(e.d,10).nkdiv(2)),r=NK.var(e.x.nksum(t),0).nkminus(e.r),n=NK.var(e.y.nksum(t),0).nkminus(e.r);this.ctx.beginPath(),this.ctx.arc(r,n,t,0,2*Math.PI),NK.isset(e.color)&&(this.ctx.fillStyle=e.color),NK.isset(e.color)&&this.ctx.fill(),NK.isset(e.border_px)&&(this.ctx.lineWidth=e.border_px),NK.isset(e.border_color)&&(this.ctx.strokeStyle=e.border_color),(NK.isset(e.border_color)||NK.isset(e.border_px))&&this.ctx.stroke()},NKCanvas.prototype.drawLine=function(e){NK.isset(e.color)&&(this.ctx.strokeStyle=e.color),NK.isset(e.w)&&(this.ctx.lineWidth=e.w),NK.isset(e.pattern)&&this.ctx.setLineDash(e.pattern),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(NK.var(e.x2,e.x),NK.var(e.y2,e.y)),this.ctx.stroke()},NKCanvas.prototype.drawText=function(e){let t=NK.var(e.font_size,12);isNaN(t)||(t+="px");var r=NK.var(e.font_weight,"normal"),n=NK.var(e.font_family,"Arial"),i=NK.var(e.font_color,"black");this.ctx.font=r+" "+t+" "+n,this.ctx.fillStyle=i,this.ctx.textBaseline="top",this.ctx.fillText(NK.var(e.text,"Text"),NK.var(e.x,0),NK.var(e.y,0))};var NKCast={};if(void 0===NK)throw"You must include base.js before cast.js";function NKBarChart(e,t=600,r=300){this.wrapper_id=e,this.drawbox=null,this.px_per_second=-1,this.px_per_value=-1,this.w=t,this.h=r,this.data_ref=[];t=document.getElementById(e)instanceof HTMLCanvasElement;this.drawbox=new(t?NKCanvas:NKDrawbox)(this.wrapper_id)}function NKCandleChart(e,t=0,r){this.wrapper_id=e,this.drawbox=null,this.nkpixelperfect=new NKPixelPerfect,this.data_ref=[];e=document.getElementById(e)instanceof HTMLCanvasElement;this.drawbox=new(e?NKCanvas:NKDrawbox)(this.wrapper_id),this.nkpixelperfect.configCandles()}function NKPixelPerfect(){this.zoom_x=3,this.zoom_y=1,this.candles={rectangle_w:5,rectangle_dist:8,chart_h:200,raw:{rectangle_w:8,rectangle_dist:7,chart_h:200}},1!==window.devicePixelRatio&&console.warn("NKPixelPerfect: The browser zoom level is not set to 100%. This may affect visual rendering.")}function NKPointChart(e,t=!0,r=600,n=300){this.wrapper_id=e,this.drawbox=null,this.connect_points=t,this.px_per_second=-1,this.px_per_value=-1,this.w=r,this.h=n,this.data_ref=[];t=document.getElementById(e)instanceof HTMLCanvasElement;this.drawbox=new(t?NKCanvas:NKDrawbox)(this.wrapper_id)}function NKTimeLineChart(e,t=600){this.wrapper_id=e,this.drawbox=null,this.horizontal=!0,this.px_per_second=-1,this.w=t;t=document.getElementById(e)instanceof HTMLCanvasElement;this.drawbox=new(t?NKCanvas:NKDrawbox)(this.wrapper_id)}function NKTimeValueChart(e,t=null,r=null,n=null){this.drawbox=new NKDrawbox(e),this.valueline_drawbox=null===t?null:new NKDrawbox(t),this.timeline_drawbox=null===r?null:new NKDrawbox(r),this.eventline_drawbox=null===n?null:new NKDrawbox(n),this.zoom_x=1,this.zoom_y=1,this.rectangle_w=5,this.rectangle_dist=8,this.chart_h=300,this.chart_w=300,this.drawings={candles:[],events:[],point_lines:{},simple_lines:{},rectangles:{}},this.drawings_calc={num_rectangles:0,min_price:0,max_price:0},this.config={rectangle_w:5,rectangle_dist:8,chart_h:300,gap_h:25},1!==window.devicePixelRatio&&console.warn("NKTimeValueChart: The browser zoom level is not set to 100%. This may affect visual rendering.")}NKCast.intByteArray={toUtf8String:function(e){for(var t="",r=0;r<e.length;r++)(e[r]<0||255<e[r])&&console.error("Error NKCast.intByteArray.toUtf8String(): ("+e[r]+") Out of range [0..255]"),t+=String.fromCharCode(e[r]);return t},toUtf16String:function(e){return NKCast.intByteArray.toUtf8String(e)},toHexString:function(e,t,r){if(!NK.isset(e))return"";for(var n="",i=0;i<e.length;i++)r&&0!=i&&(n+=" "),n+=NKCast.intByte.toHexString(e[i],t);return n},toInt:function(e){for(var t=0,r=1,n=e.length-1;0<=n;n--)(e[n]<0||255<e[n])&&console.error("Error NKCast.intByteArray.toUtf16String(): ("+e[n]+") Out of range [0..255]"),t+=e[n]*r,r*=256;return t}},NKCast.intByte={toHexString:function(e,t){return(e<0||255<e)&&console.error("Error NKCast.intByte.toHexString(): ("+e+") Out of range [0..255]"),t?"0x"+e.toString(16):e.toString(16)}},NKCast.utf16String={toIntByteArray:function(e){for(var t="",r=0;r<e.length;r++)t+=e.charCodeAt(r);return t}},NKCast.utf8String={toIntByteArray:function(e){return NKCast.utf16String.toIntByteArray(e)}},NKBarChart.prototype.setSize=function(e=600,t=300){this.w=e,this.h=t},NKBarChart.prototype.setScale=function(e=.1,t=.1){this.px_per_second=e,this.px_per_value=t},NKBarChart.prototype.setMouseMoveCbk=function(n){let i=this;this.drawbox.onMouseMoveCbk=function(e,t){var r=parseInt(e.nkdiv(i.px_per_second).nkdiv(60));try{n(e,t,i.data_ref[r])}catch(e){}}},NKBarChart.prototype.drawBars=function(o){if(0!==o.length){this.data_ref=o;let t=1/0,r=0,n=1/0,i=0;for(let e=0;e<o.length;e++)o[e].value<t&&(t=o[e].value),o[e].value>r&&(r=o[e].value),o[e].timestamp<n&&(n=o[e].timestamp),o[e].timestamp>i&&(i=o[e].timestamp);n=n.nkdiv(1e3),i=i.nkdiv(1e3),-1===this.px_per_second&&(this.px_per_second=this.w.nkdiv(i.nkminus(n))),-1===this.px_per_value&&(this.px_per_value=this.h.nkdiv(r.nkminus(t)));var e=t<0,s=(this.h=r.nkminus(t).nkmul(this.px_per_value),this.w=i.nkminus(n).nkmul(this.px_per_second),this.drawbox.clean(),this.drawbox.setSize(this.w,this.h),e&&(e=this.h.nksum(t.nkmul(this.px_per_value)),this.drawbox.drawLine({x:0,y:e,x2:this.w,y2:e,w:1,color:"#E0E3EB"})),50..nkmul(this.px_per_second));for(let e=0;e<o.length;e++){var a=o[e],l=a.timestamp.nkdiv(1e3).nkminus(n).nkmul(this.px_per_second),c=a.value.nkmul(this.px_per_value),u=this.h.nkminus(a.value.nkminus(t).nkmul(this.px_per_value));this.drawbox.drawRect({x:l,y:u,w:s,h:c,color:a.color,border_px:0})}}},NKCandleChart.prototype.setZoom=function(e=1,t=1){this.nkpixelperfect.setCandlesZoom(e,t)},NKCandleChart.prototype.setMouseMoveCbk=function(n=(e,t,r)=>{}){let i=this;this.drawbox.onMouseMoveCbk=function(e,t){var r=i.nkpixelperfect.candles.rectangle_dist-i.nkpixelperfect.candles.rectangle_w,r=Math.trunc((e+r/2)/i.nkpixelperfect.candles.rectangle_dist);n(e,t,r)}},NKCandleChart.prototype.getCandleData=function(t){let r=1/0,n=0,i=1/0,o=0;for(let e=0;e<t.length;e++)t[e].low<r&&(r=t[e].low),t[e].high>n&&(n=t[e].high),t[e].timestamp<i&&(i=t[e].timestamp),t[e].timestamp>o&&(o=t[e].timestamp);return i=i.nkdiv(1e3),o=o.nkdiv(1e3),{min_price:r,max_price:n,min_timestamp:i,max_timestamp:o}},NKCandleChart.prototype.drawCandles=function(t){if(0!==t.length){this.data_ref=t;var r=this.getCandleData(t),n=this.nkpixelperfect.calcCandlesPxPerValue(r.min_price,r.max_price),e=this.nkpixelperfect.candles.chart_h,i=this.nkpixelperfect.calcCandlesTotalWidth(t.length);this.drawbox.clean(),this.drawbox.setSize(i,e);for(let e=0;e<t.length;e++){var o=t[e],s=(o.low-r.min_price)*n,a=(o.high-r.min_price)*n,l=(o.open-r.min_price)*n,c=(o.close-r.min_price)*n,o=o.color||(l<c?"#EF5350":"#26A69A"),u=this.nkpixelperfect.candles.rectangle_dist.nkmul(e),d=u.nksum(this.nkpixelperfect.candles.rectangle_w.nkminus(1).nkdiv(2));this.drawbox.drawLine({x:d,by:a,x2:d,by2:s,w:1,color:o}),this.drawbox.drawRect({x:u,by:Math.max(l,c),w:this.nkpixelperfect.candles.rectangle_w,h:l.nkminus(c).nkabs(),color:o,border_px:0})}}},NKPixelPerfect.prototype.configCandles=function(e=5,t=3,r=200){this.candles.raw.rectangle_w=e,this.candles.raw.rectangle_dist=e.nksum(t),this.candles.raw.chart_h=r,e%2==0&&console.error("NKPixelPerfect.configCandles: rectangle_w debe ser impar para que la linea central quede bien alineada."),this.setCandlesZoom(this.zoom_x,this.zoom_y)},NKPixelPerfect.prototype.setCandlesZoom=function(e=1,t=1){this.zoom_x=parseInt(e),this.zoom_y=parseInt(t);e=2..nkmul(this.zoom_x-1),t=10..nkmul(this.zoom_y-1);this.candles.rectangle_w=this.candles.raw.rectangle_w.nksum(e),this.candles.rectangle_dist=this.candles.raw.rectangle_dist.nksum(e),this.candles.chart_h=this.candles.raw.chart_h.nksum(t)},NKPixelPerfect.prototype.calcCandlesTotalWidth=function(e){return this.candles.rectangle_dist.nkmul(e-1).nksum(this.candles.rectangle_w)},NKPixelPerfect.prototype.calcCandlesPxPerValue=function(e,t){return this.candles.chart_h.nkdiv(t.nkminus(e))},NKPixelPerfect.prototype.calcCandlePos=function(e,t,r){t=this.candles.chart_h.nkdiv(t.nkminus(e));return r.nkminus(e).nkmul(t)},NKPixelPerfect.prototype.configBars=function(e){},NKPointChart.prototype.setSize=function(e=600,t=300){this.w=e,this.h=t},NKPointChart.prototype.setScale=function(e=.1,t=.1){this.px_per_second=e,this.px_per_value=t},NKPointChart.prototype.setMouseMoveCbk=function(n){let i=this;this.drawbox.onMouseMoveCbk=function(e,t){var r=parseInt(e.nkdiv(i.px_per_second).nkdiv(60));try{n(e,t,i.data_ref[r])}catch(e){}}},NKPointChart.prototype.drawPoints=function(a){if(0!==a.length){this.data_ref=a;let t=1/0,r=0,n=1/0,i=0;for(let e=0;e<a.length;e++)a[e].value<t&&(t=a[e].value),a[e].value>r&&(r=a[e].value),a[e].timestamp<n&&(n=a[e].timestamp),a[e].timestamp>i&&(i=a[e].timestamp);n=n.nkdiv(1e3),i=i.nkdiv(1e3),-1===this.px_per_second&&(this.px_per_second=this.w.nkdiv(i.nkminus(n))),-1===this.px_per_value&&(this.px_per_value=this.h.nkdiv(r.nkminus(t)));var e=t<0;this.h=r.nkminus(t).nkmul(this.px_per_value),this.w=i.nkminus(n).nkmul(this.px_per_second),this.drawbox.clean(),this.drawbox.setSize(this.w,this.h),e&&(e=this.h.nksum(t.nkmul(this.px_per_value)),this.drawbox.drawLine({x:0,y:e,x2:this.w,y2:e,w:1,color:"#E0E3EB"}));let o=null,s=null;for(let e=0;e<a.length;e++){var l=a[e],c=l.timestamp.nkdiv(1e3).nkminus(n).nkmul(this.px_per_second),u=this.h.nkminus(l.value.nkminus(t).nkmul(this.px_per_value));!this.connect_points&&!0!==l.connect_prev||!1===l.connect_prev||null===o||this.drawbox.drawLine({x:o,y:s,x2:c,y2:u,w:1,color:"blue",style:"solid"}),this.drawbox.drawCircle({x:c,y:u,r:1.5,color:"blue"}),o=c,s=u}}},NKTimeLineChart.prototype.setSize=function(e=600){this.w=e},NKTimeLineChart.prototype.setScale=function(e=.1){this.px_per_second=e},NKTimeLineChart.prototype.setMouseMoveCbk=function(r){this.drawbox.onMouseMoveCbk=function(e,t){r(e,t,null)}},NKTimeLineChart.prototype.drawValues=function(e,r,t=0){var n=e.nkdiv(1e3),i=r.nkdiv(1e3);if(-1===this.px_per_second&&(this.px_per_second=this.w.nkdiv(i.nkminus(n))),this.w=i.nkminus(n).nkmul(this.px_per_second),this.drawbox.clean(),this.horizontal){this.drawbox.setSize(this.w,28);var i=new Date(e),o=new Date(e),n=(o.setHours(i.getHours()+1,0,0,0),NKDate.getUnixTimestamp(o)-i),s=Math.floor(r.nkminus(e).nkdiv(36e5));let t=n.nkdiv(1e3).nkmul(this.px_per_second);for(let e=0;e<s;e++){this.drawbox.drawLine({x:t,y:0,x2:t,y2:4});var a=NKDate.getString(o,"hh:mm"),l=NKDate.getString(o,"DD/MM");this.drawbox.drawText({x:t,y:5,text:a,font_size:10,font_family:"Arial, sans-serif"}),this.drawbox.drawText({x:t,y:14,text:l,font_size:10,font_family:"Arial, sans-serif"}),t+=3600..nkmul(this.px_per_second),NKDate.addHours(o,1)}}else this.drawbox.setSize(50,this.w),console.error("NKScaleChart vertical: Not implemented.")},NKTimeValueChart.prototype.setSize=function(e=5,t=3,r=300,n=25){this.config.rectangle_w=e,this.config.rectangle_dist=e.nksum(t),this.config.chart_h=r,this.config.gap_h=n,e%2==0&&console.error("NKPixelPerfect.configCandles: rectangle_w debe ser impar para que la linea central quede bien alineada."),this.setZoom(null,null,!1)},NKTimeValueChart.prototype.setZoom=function(e=null,t=null,r=!0){this.zoom_x=null!==e?parseInt(e):this.zoom_x,this.zoom_y=null!==t?parseInt(t):this.zoom_y;e=2..nkmul(this.zoom_x-1),t=10..nkmul(this.zoom_y-1);this.rectangle_w=this.config.rectangle_w.nksum(e),this.rectangle_dist=this.config.rectangle_dist.nksum(e),this.chart_h=this.config.chart_h.nksum(t),r&&this.repaint()},NKTimeValueChart.prototype.getYFromValue=function(e){var t=this.chart_h.nkdiv(this.drawings_calc.max_price.nkminus(this.drawings_calc.min_price));return e.nkminus(this.drawings_calc.min_price).nkmul(t)},NKTimeValueChart.prototype.getValueFromY=function(e){var t=this.chart_h.nkdiv(this.drawings_calc.max_price.nkminus(this.drawings_calc.min_price));return this.chart_h.nkminus(e).nkdiv(t).nksum(this.drawings_calc.min_price)},NKTimeValueChart.prototype.getTimeFromX=function(e){var t=this.rectangle_dist-this.rectangle_w;return Math.trunc((e+t/2)/this.rectangle_dist)},NKTimeValueChart.prototype.getXFromTimei=function(e){var t=this.rectangle_dist-this.rectangle_w;return e.nkmul(this.rectangle_dist).nkminus(t/2)},NKTimeValueChart.prototype.addCandle=function(e,t,r,n,i,o,s=null){this.drawings.candles.push({time_i:e,t:t,high:r,open:n,close:i,low:o,color:s})},NKTimeValueChart.prototype.addLinePoint=function(e,t,r){void 0===this.drawings.point_lines[e]&&(this.drawings.point_lines[e]=[]),this.drawings.point_lines[e][t]=r},NKTimeValueChart.prototype.addLineArray=function(e,t){this.drawings.point_lines[e]=t},NKTimeValueChart.prototype.addHorizontalLine=function(e,t,r="lightblue"){this.drawings.simple_lines[e]={t1:0,t2:null,v1:t,v2:t,color:r}},NKTimeValueChart.prototype.addRectangle=function(e,t,r,n,i=null){void 0===this.drawings.rectangles[e]&&(this.drawings.rectangles[e]=[]),this.drawings.rectangles[e][t]=[r,n,i]},NKTimeValueChart.prototype.addRectangleArray=function(e,t){this.drawings.rectangles[e]=t},NKTimeValueChart.prototype.addEvent=function(e,t="Event title",r="Event text",n=null){this.drawings.events.push({time_i:e,title:t,text:r,args:n})},NKTimeValueChart.prototype._drawingsLoop=function(t=function(e,t,r,n){},r=!0){for(let e=0;e<this.drawings.candles.length;e++)!r&&null===this.drawings.candles[e].c||t("candle","default",e,this.drawings.candles[e]);for(var[n,i]of Object.entries(this.drawings.point_lines))for(let e=0;e<i.length;e++)!r&&null===i[e]||t("line",n,e,i[e]);for(var[e,o]of Object.entries(this.drawings.simple_lines))t("simple_line",e,null,o);for(var[s,a]of Object.entries(this.drawings.rectangles))for(let e=0;e<a.length;e++){if(!r){if(void 0===a[e])continue;if(null===a[e])continue;if(null===a[e][0]||null===a[e][1])continue}t("rectangle",s,e,a[e])}},NKTimeValueChart.prototype.repaint=function(){this.drawings_calc={num_rectangles:0,min_price:1/0,max_price:0},this._drawingsLoop((e,t,r,n)=>{r+1>this.drawings_calc.num_rectangles&&(this.drawings_calc.num_rectangles=r+1);let i=null,o=null;"candle"===e?(i=n.high,o=n.low):"line"===e?(i=n,o=n):"simple_line"===e?(i=Math.max(n.v1,n.v2),o=Math.min(n.v1,n.v2)):"rectangle"===e&&(i=Math.max(n[0],n[1]),o=Math.min(n[0],n[1])),null!==i&&i>this.drawings_calc.max_price&&(this.drawings_calc.max_price=i),null!==o&&o<this.drawings_calc.min_price&&(this.drawings_calc.min_price=o)},!1),this.chart_w=(this.drawings_calc.num_rectangles-1).nkmul(this.rectangle_dist).nksum(this.rectangle_w),this.drawbox.clean(),this.drawbox.setSize(this.chart_w,this.chart_h);for(let e=0;e<this.drawings.candles.length;e++){var t=this.drawings.candles[e];this.drawCandle(t.time_i,t.high,t.open,t.close,t.low,t.color)}for(var[e,n]of Object.entries(this.drawings.point_lines)){let t=null,r=null;for(let e=0;e<n.length;e++){var i,o;null!==n[e]&&(i=e.nkmul(this.rectangle_dist),o=this.getYFromValue(n[e]).nkfixed(2),null!==t&&this.drawbox.drawLine({x:t,x2:i,by:r,by2:o,color:"lightblue"}),t=i,r=o)}}for(var[r,s]of Object.entries(this.drawings.rectangles))for(let e=0;e<s.length;e++)void 0!==s[e]&&null!==s[e]&&null!==s[e][0]&&null!==s[e][1]&&this.drawRectangle(e,s[e][0],s[e][1],s[e][2]);for(var[a,l]of Object.entries(this.drawings.simple_lines)){var c=l.t1.nkmul(this.rectangle_dist),u=null===l.t2?this.chart_w:l.t2.nkmul(this.rectangle_dist),d=this.getYFromValue(l.v1).nkfixed(2),h=this.getYFromValue(l.v2).nkfixed(2);this.drawbox.drawLine({x:c,x2:u,by:d,by2:h,color:l.color})}this.drawTimeLine(),this.drawValueLine(),this.drawEventLine()},NKTimeValueChart.prototype.drawCandle=function(e,t,r,n,i,o=null){null===o&&(o=r<n?"#EF5350":"#26A69A");var e=e.nkmul(this.rectangle_dist),s=e.nksum(this.rectangle_w.nkminus(1).nkdiv(2));null!==t&&null!==i&&(t=this.getYFromValue(t),i=this.getYFromValue(i),this.drawbox.drawLine({x:s,by:t,x2:s,by2:i,w:1,color:o})),null!==r&&null!==n&&(r=this.getYFromValue(r),n=this.getYFromValue(n),this.drawbox.drawRect({x:e,by:Math.max(r,n),w:this.rectangle_w,h:r.nkminus(n).nkabs(),color:o}))},NKTimeValueChart.prototype.drawRectangle=function(e,t,r,n=null){null===n&&(n=r<t?"#EF5350":"#26A69A");e=e.nkmul(this.rectangle_dist),t=this.getYFromValue(t),r=this.getYFromValue(r);this.drawbox.drawRect({x:e,by:Math.max(t,r),w:this.rectangle_w,h:t.nkminus(r).nkabs(),color:n})},NKTimeValueChart.prototype.drawTimeLine=function(){if(null!==this.timeline_drawbox){this.timeline_drawbox.clean(),this.timeline_drawbox.setSize(this.chart_w,28);var t,r,n,i=this.drawings_calc.num_rectangles,o=this.drawings.candles;for(let e=0;e<i;e++)e%10==0&&(t=e.nkmul(this.rectangle_dist).nksum(this.rectangle_w.nkminus(1).nkdiv(2)),this.timeline_drawbox.drawLine({x:t,y:0,x2:t,y2:4}),void 0!==o[e])&&(n=new Date(o[e].t),console.log(e,o[e].t),r=NKDate.getString(n,"hh:mm"),n=NKDate.getString(n,"DD/MM/YY"),this.timeline_drawbox.drawText({x:t,y:5,text:r,font_size:10,font_family:"Arial, sans-serif"}),this.timeline_drawbox.drawText({x:t,y:14,text:n,font_size:10,font_family:"Arial, sans-serif"}))}},NKTimeValueChart.prototype.drawEventLine=function(){if(null!==this.eventline_drawbox){var t=this.drawings.events;this.eventline_drawbox.clean(),this.eventline_drawbox.setSize(this.chart_w,20);for(let e=0;e<t.length;e++){var r=t[e],n=r.time_i.nkmul(this.rectangle_dist).nksum(this.rectangle_w.nkminus(1).nkdiv(2));this.eventline_drawbox.drawLine({x:n,y:0,x2:n,y2:4}),this.eventline_drawbox.drawText({x:n,y:5,text:r.title,font_size:12,font_family:"Arial, sans-serif"})}}},NKTimeValueChart.prototype.drawValueLine=function(){if(null!==this.valueline_drawbox){this.valueline_drawbox.clean(),this.valueline_drawbox.setSize(50,this.chart_h);let e=7;for(;e<this.chart_h;)this.valueline_drawbox.drawLine({x:0,y:e,x2:5,y2:e}),this.valueline_drawbox.drawText({x:8,y:e-5,text:this.getValueFromY(e).toFixed(2),font_size:10,font_family:"Arial, sans-serif"}),e+=this.config.gap_h}},NKTimeValueChart.prototype.setMouseMoveCbk=function(r=(e,t,r,n)=>{}){let n=this;this.drawbox.onMouseMoveCbk=function(e,t){r(e,t,n.getTimeFromX(e),n.getValueFromY(t))}};var NKClipboard={set:function(e){var t=document.createElement("textarea"),e=(t.style.position="absolute",t.style.left="-10000px",t.readonly=!0,t.value=e,document.body.appendChild(t),0<document.getSelection().rangeCount&&document.getSelection().getRangeAt(0));t.select(),document.execCommand("copy"),document.body.removeChild(t),e&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(e))},get:function(){return navigator.clipboard.readText()}},NKContextMenu={};if(void 0===NK)throw"You must include base.js before context_menu.js";var nkcontextmenu_event_listener=new NKEventListener,NKContextMenu={...nkcontextmenu_event_listener,start:function(){if(!NK.isset(NKContextMenu.loaded)||!0!==NKContextMenu.loaded){if(NKContextMenu.loaded=!0,void 0===NKPosition)throw"You must include position.js";if(null===document.body)throw"The <body> tag must be fully loaded before calling NKContextMenu.start()";var e;NKPosition.start(),document.getElementById("NKContextMenu")||((e=document.createElement("div")).setAttribute("id","NKContextMenu"),document.body.appendChild(e)),document.getElementById("NKContextMenu").style.display="none";let r=null;document.addEventListener("contextmenu",function(e){var t=e.target,t=(r=t,NKContextMenu.dispatchEvent("onOpen",{target:t}),document.getElementById("NKContextMenu"));0===t?.children.length?t.style.display="none":(t.style.display="block",document.querySelectorAll("#NKContextMenu .NKSubmenu").forEach(e=>e.style.display="none"),t.style.left=NKPosition.getMouseX()+"px",t.style.top=NKPosition.getMouseY()+"px",e.preventDefault())}),document.addEventListener("mouseup",function(e){var t;2!==e.button&&(t=document.getElementById("NKContextMenu"))&&"none"!==getComputedStyle(t).display&&((t=e.target).classList.contains("NKItem")?NKContextMenu.dispatchEvent("onClose",{id:t.getAttribute("data-id"),text:t.querySelector(".NKTitle")?.textContent,target:r,button:t}):NKContextMenu.dispatchEvent("onClose",{id:null,target:r,button:null}),document.getElementById("NKContextMenu").style.display="none")}),NKContextMenu.refresh()}}};NKContextMenu.setContent=function(e){var t=[];function s(e,t,r,n){var i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");if(i.classList.add("NKItem"),o.classList.add("NKIcon"),s.classList.add("NKTitle"),i.setAttribute("data-id",e),s.textContent=t,NK.empty(r)||(r instanceof Node?o.appendChild(r):o.innerHTML=r,o.style.marginRight="5px"),i.appendChild(o),i.appendChild(s),null!==n){let t=document.createElement("div");t.classList.add("NKSubmenu"),n.forEach(e=>t.appendChild(e)),i.classList.add("NKArrow"),i.appendChild(t)}return i}NK.empty(e)||(t=function t(r){var n=[];for(let e=0;e<r.length;e++){var i,o=r[e];"item"===o.type?n.push(s(o.id,o.text,o.icon,null)):"menu"===o.type?(i=t(o.items),n.push(s(o.id,o.text,o.icon,i))):"divider"===o.type&&((i=document.createElement("div")).classList.add("NKDivider"),n.push(i))}return n}(e));let r=document.getElementById("NKContextMenu");r.innerHTML="",t.forEach(e=>r.appendChild(e)),NKContextMenu.refresh()},NKContextMenu.refresh=function(){function t(e){var e=e.currentTarget,t=(e.parentNode.querySelectorAll(".NKSubmenu").forEach(e=>e.style.display="none"),e.querySelector(".NKSubmenu"));t&&(t.style.display="block",t.style.left=e.offsetWidth-5+"px")}document.querySelectorAll(".NKItem").forEach(e=>{e.removeEventListener("mouseenter",t),e.addEventListener("mouseenter",t)})};let NKDate={set:function(e,t=null,r=null,n=null,i=null,o=null,s=null,a=null){return e.setTime(new Date(n,r-1,t,i,o,s,a).getTime()),e},clone:function(e){return new Date(e.getTime())},setFromString:function(t,e,r){var n=e.split(/(?:\/|-| |:|\\)+/),i=r.split(/(?:\/|-| |:|\\)+/);if(n.length!==i.length)throw"Date ("+e+") does not fit the pattern ("+r+")";t.setHours(0,0,0,0);for(let e=0;e<i.length;e++)switch(i[e]){case"DD":NKDate.setDay(t,n[e]);break;case"MM":NKDate.setMonth(t,n[e]);break;case"YYYY":case"YY":NKDate.setYear(t,n[e]);break;case"hh":NKDate.setHour(t,n[e]);break;case"mm":NKDate.setMinute(t,n[e]);break;case"sss":NKDate.setMilisecond(t,n[e]);break;case"ss":NKDate.setSecond(t,n[e])}return t},getString:function(e,t="DD/MM/YYYY"){let r=t;return r=(r=(r=(r=(r=(r=(r=(r=r.replaceAll("DD",NKDate.getDay(e,!0))).replaceAll("MM",NKDate.getMonth(e,!0))).replaceAll("YYYY",NKDate.getYear(e,!0))).replaceAll("YY",NKDate.getYear(e,!1))).replaceAll("hh",NKDate.getHour(e,!0))).replaceAll("mm",NKDate.getMinute(e,!0))).replaceAll("sss",NKDate.getMillisecond(e,!0))).replaceAll("ss",NKDate.getSecond(e,!0))},getDay:function(e,t=!0){let r=e.getDate();return r=t?r.toString().padStart(2,"0"):r},setDay:function(e,t){if(null!==t)return e.setDate(t),e},getMonth:function(e,t=!0){let r=e.getMonth()+1;return r=t?r.toString().padStart(2,"0"):r},setMonth:function(e,t){if(null!==t)return e.setMonth(parseInt(t)-1),e},getYear:function(e,t=!0){if(t)return e.getFullYear();let r=e.getYear();return 100<r&&(r-=100),r},setYear:function(e,t){if(null!==t)return parseInt(t)<100&&(t="20"+t),e.setFullYear(t),e},getHour:function(e,t=!0){let r=e.getHours();return r=t?r.toString().padStart(2,"0"):r},setHour:function(e,t){if(null!==t)return e.setHours(t),e},getMinute:function(e,t=!0){let r=e.getMinutes();return r=t?r.toString().padStart(2,"0"):r},setMinute:function(e,t){if(null!==t)return e.setMinutes(t),e},getSecond:function(e,t=!0){let r=e.getSeconds();return r=t?r.toString().padStart(2,"0"):r},setSecond:function(e,t){if(null!==t)return e.setSeconds(t),e},getMillisecond:function(e,t=!0){let r=e.getMilliseconds();return r=t?r.toString().padStart(3,"0"):r},setMilisecond:function(e,t){if(null!==t)return e.setMilliseconds(t),e},getUnixTimestamp:function(e){return e.getTime()},addMonths:function(e,t){return e.setMonth(e.getMonth()+t),e},addHours:function(e,t){return NKDate.addMiliseconds(e,60*t*6e4)},addMinutes:function(e,t){return NKDate.addMiliseconds(e,60*t*1e3)},addSeconds:function(e,t){return NKDate.addMiliseconds(e,1e3*t)},addMiliseconds:function(e,t){return e.setTime(e.getTime()+t),e},print:function(e){console.log(e.toLocaleString())},equals:function(e,t,r=!0){return r?e.getTime()===t.getTime():e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},daysInMonth:function(e,t){if(0===t)throw"Month 0 does not exist, January is month 1.";return 32-new Date(e,t-1,32).getDate()},firstDayOfMonth:function(e,t,r=!1){if(0===t)throw"Month 0 does not exist, January is month 1.";e=new Date(e,t-1).getDay();return r?e:0===e?6:e-1},getDatesBetween:function(e,t=null){null===t&&(t=e);for(var r=[],n=new Date(e);n<=t;)r.push(new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)),n.setDate(n.getDate()+1);return r},getCalendar:function(t,r,e=!0,n=!1){var i=[],o=new Date,s=t===o.getFullYear()&&r===o.getMonth()+1;if(e){var a=NKDate.firstDayOfMonth(t,r,n);for(let e=0;e<a;e++)i.push({day:"",today:!1,date:null})}var l=NKDate.daysInMonth(t,r);for(let e=0;e<l;e++)i.push({day:e+1,today:s&&e+1===o.getDate(),date:new Date(t,r-1,e+1)});return i},setCalendarTasks:function(t,r,n,i,o,s){for(let e=0;e<r.length;e++){var a=r[e],l="0000-00-00 00:00:00"===a[o]?null:new Date(a[o].replace(/-/g,"/")).getTime(),c="0000-00-00 00:00:00"===a[s]?null:new Date(a[s].replace(/-/g,"/")).getTime();for(let e=0;e<t.length;e++){var u,d,h=t[e];null!==h[n]&&(d=(u=h[n].getTime())+86399999,null===c&&u<=l&&l<=d&&h[i].push(NKObject.clone(a)),null===l?console.error("Task with date_end without date_start"):u<=c&&l<=d&&h[i].push(NKObject.clone(a)))}}}},NKDebounce={timeoutId:{},callOnce:function(e,t=200){var r=NKDebounce.getCallLine();clearTimeout(NKDebounce.timeoutId[r]),NKDebounce.timeoutId[r]=setTimeout(()=>{e()},t)},getCallLine:function(){var e=(new Error).stack.match(/\(([^)]+)\)/);let t=e?e[1]:null;return null===t?(console.error("NKDebounce error."),""):(t=t.split("/"))[t.length-1]}},NKDrag=(NKDomTemplate={},NKDom={},NKDomTemplate.register=function(e,t){void 0!==customElements.get(e)?console.error("Error, "+e+" is already registered."):customElements.define(e,class extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=t}})},NKDomTemplate.start=function(){var t=document.querySelectorAll("template");for(let e=0;e<t.length;e++)NKDomTemplate.register(t[e].attributes.name.value,t[e].innerHTML)},NKDomTemplate.fill=function(t,e){var r=Array.isArray(e)?e:[e];let n="";for(let e=0;e<r.length;e++){n+="<"+t+">";for(var[i,o]of Object.entries(r[e]))n+='<span slot="'+i+'">'+o+"</span>";n+="</"+t+">"}return n},NKDom.parseIdOrClass=function(e){var t={is_class:!1,is_id:!1,name:""};return 0!==e.length&&(t.is_id="#"===e[0],t.is_class="."===e[0],t.name=e.slice(1)),t},NKDom.select=function(e){var t=document.querySelectorAll(e);return"#"===e[0]?t[0]:t},NKDom.getElementList=function(e){return(e="string"==typeof e?NKDom.select(e):e)instanceof NodeList?e:e instanceof Node?[e]:[]},NKDom.getElement=function(e){return(e="string"==typeof e?NKDom.select(e):e)instanceof NodeList&&0<e.length?e[0]:e instanceof Node?e:void 0},NKDom.getChildren=function(e,r=""){let n=[];r=r.toLowerCase(),NKDom.getElementList(e).forEach(function(t,e){for(let e=0;e<t.children.length;e++)""!==r&&t.children[e].tagName.toLowerCase()!==r||n.push(t.children[e])});var e=document.createDocumentFragment().childNodes,i=Object.create(e,{length:{value:n.length,enumerable:!1},item:{value:function(e){return this[+e||0]},enumerable:!1}});return n.forEach((e,t)=>i[t]=e),i},NKDom.getClosest=function(e,t){if(e=NKDom.getElement(e),(t=NKDom.parseIdOrClass(t)).is_class){for(;e&&e.classList&&!e.classList.contains(t.name);)e=e.parentNode;e.classList&&e.classList.contains(t.name)||(e=null)}else if(t.is_id){for(;e&&e.id!==t.name;)e=e.parentNode;e.id!==t.name&&(e=null)}return e},NKDom.setCss=function(e,t,r){let n=t.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()});NKDom.getElementList(e).forEach(function(e,t){e.style[n]=r})},NKDom.getCss=function(e,t){let r=t.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}),n=[];if(NKDom.getElementList(e).forEach(function(e,t){n.push(window.getComputedStyle(e)[r])}),0!==n.length)return 1===n.length?n[0]:n},NKDom.setAttribute=function(e,r,n){NKDom.getElementList(e).forEach(function(e,t){e.setAttribute(r,n)})},NKDom.getAttribute=function(e,t){if(0!==(e=NKDom.getElementList(e)).length)return e[0].getAttribute(t)},NKDom.addClass=function(e,r){NKDom.getElementList(e).forEach(function(e,t){e.classList.add(r)})},NKDom.removeClass=function(e,r){NKDom.getElementList(e).forEach(function(e,t){e.classList.remove(r)})},NKDom.hasClass=function(e,t){for(var r=NKDom.getElementList(e),n=0;n<r.length;n++)if(r[n].classList.contains(t))return!0;return!1},NKDom.setHtml=function(e,r){NKDom.getElementList(e).forEach(function(e,t){e.innerHTML=r})},NKDom.appendHtml=function(e,r){NKDom.getElementList(element).forEach(function(e,t){e.insertAdjacentHTML("afterend",r)})},NKDom.addEventListener=function(e,r,n,i=!0){NKDom.getElementList(e).forEach(function(e,t){i&&e.removeEventListener(r,n),e.addEventListener(r,n)})},{}),nkdrag_event_listener=new NKEventListener;function NKDrawbox(e,t=400,r=200){if(this.wrapper=null,this.shadow=null,this.onMouseMoveCbk=null,this.drawings=[],this.h=r,this.w=t,this.wrapper=document.getElementById(e),null===this.wrapper)return console.error("NKDrawbox: Error, invalid id '"+e+"'");this.wrapper.style.display="inline-block",this.wrapper.style.width=t+"px",this.wrapper.style.height=r+"px",this.wrapper.style.overflow="hidden",this.wrapper.style.position="relative",this.wrapper.innerHTML="",this.shadow=this.wrapper.shadowRoot||this.wrapper.attachShadow({mode:"open"}),this.wrapper.addEventListener("mousemove",e=>{null!==this.onMouseMoveCbk&&this.onMouseMoveCbk(e.offsetX,e.offsetY)})}NKDrag={...nkdrag_event_listener,selection:{element:null,wrapper:null}},NKDrag.start=function(e){if(!NK.isset(NKDrag.loaded)||!0!==NKDrag.loaded){if(NKDrag.loaded=!0,void 0===NKPosition)throw"You must include NKPosition.js";NKPosition.start(),window.addEventListener("load",NKDrag.reload),!0===window.loaded&&NKDrag.reload(),!0===e&&NK.core.reloadOnDomChange(NKDrag),NKDom.addEventListener(document,"mousemove",function(e){var t,r;null!=NKDrag.selection.element&&(t=NKPosition.getMouseX()-NKDrag.selection.offset[0],r=NKPosition.getMouseY()-NKDrag.selection.offset[1],NKDrag.moveElement(NKDrag.selection.element,t,r))}),NKDom.addEventListener(document,"mouseup",function(e){null!==NKDrag.selection.wrapper&&(NKDrag.selection.element.style.transition="transform 0.5s ease",NKDrag.selection.element.style.transform="",NKDrag.dispatchEvent("onDragEnd",{e:NKDrag.selection.element,items:Array.from(NKDrag.selection.wrapper.querySelectorAll(".NKDrag_dst"))})),NKDrag.selection.element=null,NKDrag.selection.wrapper=null})}},NKDrag.moveElement=function(e,n=0,i=0){if("column"===NKDrag.selection.wrapper_direction){let t=NKDrag.selection.wrapper;var o=Array.from(t.querySelectorAll(".NKDrag_dst"));let r=!0;o.sort(function(e,t){e=e.getBoundingClientRect().y-t.getBoundingClientRect().y;return e<=0&&(r=!1),e});var s=e.getBoundingClientRect().y;o.forEach(e=>t.appendChild(e)),r||(i-=o=e.getBoundingClientRect().y-s,NKDrag.selection.offset[1]+=o)}if("row"===NKDrag.selection.wrapper_direction){let t=NKDrag.selection.wrapper;s=Array.from(t.querySelectorAll(".NKDrag_dst"));let r=!0;s.sort(function(e,t){e=e.getBoundingClientRect().x-t.getBoundingClientRect().x;return e<=0&&(r=!1),e});o=e.getBoundingClientRect().x;s.forEach(e=>t.appendChild(e)),r||(n-=s=e.getBoundingClientRect().x-o,NKDrag.selection.offset[0]+=s)}NKDrag.selection.element.style.transition="",e.style.transform=`translate(${n}px, ${i}px)`,NKDrag.dispatchEvent("onDrag",{e:e,position:{left:n,top:i}})},NKDrag.reload=function(){NKDom.addEventListener(".NKDrag_src","mousedown",function(e){var t=NKDom.getClosest(this,".NKDrag_wrapper");NKDrag.selection.wrapper=t,NKDrag.selection.wrapper_direction=null===t?null:getComputedStyle(NKDrag.selection.wrapper).flexDirection,NKDrag.selection.element=NKDom.getClosest(this,".NKDrag_dst"),NKDrag.selection.offset=NKPosition.getMouse();try{var r=/translate\(\s*([-+]?\d*\.?\d+px)\s*,\s*([-+]?\d*\.?\d+px)\s*\)/,n=NKDrag.selection.element.style.transform.match(r);NKDrag.selection.offset[0]-=parseFloat(n[1]),NKDrag.selection.offset[1]-=parseFloat(n[2])}catch(e){}})},NKDrawbox.prototype.clean=function(){this.shadow.innerHTML="",this.first_time=!1},NKDrawbox.prototype.setSize=function(e=400,t=200){this.wrapper.style.width=e+"px",this.wrapper.style.height=t+"px",this.h=t,this.w=e},NKDrawbox.prototype._drawDiv=function(e){var t=document.createElement("div"),r=(this.first_time||(this.first_time=!0,(r=document.createElement("style")).textContent=`
        div {
            position: absolute;
            transform-origin: left top;
        }
        `,this.shadow.appendChild(r)),[]);"string"==typeof e.class?r.push(e.class):Array.isArray(e.class)&&r.push(...e.class),0<r.length&&(t.className=r.join(" ")),NK.isset(e.origin)&&(t.style.transformOrigin=e.origin),NK.isset(e.h)&&e.h<0&&(e.h=e.h.nkabs(),NK.isset(e.y))&&(e.y=e.y.nksubtract(e.h)),NK.isset(e.x)&&(t.style.left=e.x+"px"),NK.isset(e.y)&&(t.style.top=e.y+"px"),NK.isset(e.w)&&(t.style.width=e.w+"px"),NK.isset(e.h)&&(t.style.height=e.h+"px"),NK.isset(e.color)&&(t.style.backgroundColor=e.color),NK.isset(e.border_radius)&&(t.style.borderRadius=e.border_radius+"%"),(e.border_px||e.border_color||e.border_style)&&(NK.isset(e.border_px)||(e.border_px=1),NK.isset(e.border_color)||(e.border_color="black"),NK.isset(e.border_style)||(e.border_style="solid"),0<e.border_px)&&(t.style.border=e.border_px+"px "+e.border_style+" "+e.border_color),(e.border_top_px||e.border_top_color||e.border_top_style)&&(NK.isset(e.border_top_px)||(e.border_top_px=1),NK.isset(e.border_top_color)||(e.border_top_color="black"),NK.isset(e.border_top_style)||(e.border_top_style="solid"),0<e.border_top_px)&&(t.style.borderTop=e.border_top_px+"px "+e.border_top_style+" "+e.border_top_color),(e.border_right_px||e.border_right_color||e.border_right_style)&&(NK.isset(e.border_right_px)||(e.border_right_px=1),NK.isset(e.border_right_color)||(e.border_right_color="black"),NK.isset(e.border_right_style)||(e.border_right_style="solid"),0<e.border_right_px)&&(t.style.borderRight=e.border_right_px+"px "+e.border_right_style+" "+e.border_right_color),(e.border_left_px||e.border_left_color||e.border_left_style)&&(NK.isset(e.border_left_px)||(e.border_left_px=1),NK.isset(e.border_left_color)||(e.border_left_color="black"),NK.isset(e.border_left_style)||(e.border_left_style="solid"),0<e.border_left_px)&&(t.style.borderLeft=e.border_left_px+"px "+e.border_left_style+" "+e.border_left_color);let n="";NK.isset(e.rotate)&&(n+=`rotate(${e.rotate}deg) `),t.style.transform=n,NK.isset(e.text)&&(t.textContent=e.text),NK.isset(e.font_color)&&(t.style.color=e.font_color),NK.isset(e.font_size)&&(t.style.fontSize=isNaN(e.font_size)?e.font_size:e.font_size+"px"),NK.isset(e.font_family)&&(t.style.fontFamily=e.font_family),NK.isset(e.font_weight)&&(t.style.fontWeight=e.font_weight),this.shadow.appendChild(t)},NKDrawbox.prototype.drawRect=function(e){NK.isset(e.by)&&(e.y=this.h.nkminus(e.by)),NK.isset(e.by2)&&(e.y2=this.h.nkminus(e.by2));var t={x:e.x??0,y:e.y??0,w:e.w??0,h:e.h??0};NK.isset(e.border_px)&&0<e.border_px&&(t.border_px=e.border_px),NK.isset(e.border_color)&&(t.border_color=e.border_color),e.x&&e.x2&&(t.w=e.x2.nkminus(e.x)),e.y&&e.y2&&(t.h=e.y2.nkminus(e.y)),e.class&&(t.class=e.class),e.color&&(t.color=e.color),e.border_style&&(t.border_style=e.border_style),this._drawDiv(t)},NKDrawbox.prototype.drawLine=function(e){if(NK.isset(e.by)&&(e.y=this.h.nkminus(e.by)),NK.isset(e.by2)&&(e.y2=this.h.nkminus(e.by2)),e.x===e.x2)return this._drawVerticalLine(e);var t={x:e.x??0,y:e.y??0,border_top_px:e.w??1,border_top_color:e.color??"black",border_top_style:e.style??"solid"};t.w=(e.x2??0).nkminus(e.x??0).nkpow(2).nksum((e.y2??0).nkminus(e.y??0).nkpow(2)).nksqrt(),t.rotate=Math.atan2((e.y2??0).nkminus(e.y??0),(e.x2??0).nkminus(e.x??0)).nkmul(180..nkdiv(Math.PI)),e.class&&(t.class=e.class),this._drawDiv(t)},NKDrawbox.prototype._drawVerticalLine=function(e){e={x:e.x,y:e.y??0,h:(e.y2??0).nkminus(e.y??0),border_left_px:e.w??1,border_left_color:e.color??"black",border_left_style:e.style??"solid"};this._drawDiv(e)},NKDrawbox.prototype.drawCircle=function(e){NK.isset(e.r)||(e.r=10);var t=e.r.nkmul(2),t={x:(e.x??0).nkminus(e.r),y:(e.y??0).nkminus(e.r),w:t,h:t,color:e.color??"black",border_radius:50};e.class&&(t.class=e.class),this._drawDiv(t)},NKDrawbox.prototype.drawText=function(e){var t;e.text&&(NK.isset(e.by)&&(e.y=this.h.nkminus(e.by)),t={x:e.x??0,y:e.y??0,text:e.text},e.class&&(t.class=e.class),e.font_color&&(t.font_color=e.font_color),e.font_size&&(t.font_size=e.font_size),e.font_family&&(t.font_family=e.font_family),e.font_weight&&(t.font_weight=e.font_weight),this._drawDiv(t))};var NKForm={};if(void 0===NK)throw"You must include base.js before form.js";NKForm.errors={duplicated_fields:!0,invalid_json:!0},NKForm.getFields=function(e,t){var r={};return $(e+" :input").each(function(){if(!NK.empty(this.name))if("[]"===this.name.slice(-2)){var e=this.name.substr(0,this.name.length-2);NK.isset(r[e])||(r[e]=[]),r[e].push($(this).val())}else{if(NKForm.errors.duplicated_fields&&NK.isset(r[this.name]))throw"NKForm.getFields: Duplicated input field with name ("+this.name+")";e=$(this).attr("type");r[this.name]="checkbox"===e?$(this).prop("checked"):$(this).val()}}),!0===t?JSON.stringify(r):r},NKForm.setFields=function(e,t,r){if(!NK.empty(t)){if(!0===r)try{t=JSON.parse(t)}catch(e){if(NKForm.errors.invalid_json)throw"NKForm.setFields: Invalid input json. ("+t+")";return}$(e+" :input").each(function(){NK.empty(t[this.name])||("checkbox"===$(this).attr("type")?$(this).prop("checked",/^(true|1)$/i.test(t[this.name])):$(this).val(t[this.name]))})}},NKForm.clearFields=function(e){$(e+" :input").each(function(){"checkbox"===$(this).attr("type")?$(this).prop("checked",!1):$(this).val("")})},NKForm.send=function(e,t,r){$.post(t,NKForm.getFields(e),function(e,t){NK.isset(r)?r(e,t):location.reload()})},NKForm.fileChooser=function(r,e,t=!1,n=!0){e=e||"",t=t?"multiple":"",$("body").append('<input type="file" id="NKtmpfile" accept="'+e+'" '+t+">");e=document.getElementById("NKtmpfile");e.addEventListener("change",async function(e){var t=await NKForm._cleanFileList(this.files,n);r(t)},!1),$("#NKtmpfile").trigger("click"),e.parentNode.removeChild(e)},NKForm.dirChooser=function(e,t){window.showDirectoryPicker({startIn:e}).then(e=>{t(e)})},NKForm.postFile=function(e,t,r,n){var i,o=new FormData;for(i in o.append("file[]",t),r)o.append(i,r[i]);$.ajax({type:"POST",url:e,contentType:!1,processData:!1,data:o,success:function(e){n(e)}})},NKForm.fileDropzone=function(e,t,r=!0){e.addEventListener("drop",async function(e){e.preventDefault();e=e.dataTransfer.files,0===e.length&&console.error("Unable to handle dragged files."),e=await NKForm._cleanFileList(e,r);t(e)}),e.addEventListener("dragover",function(e){e.preventDefault()})},NKForm._cleanFileList=async function(e,t=!0){for(var r=[],n=0;n<e.length;n++){var i=e[n],o={file_obj:i,name:i.name,size:i.size,type:i.type,lastModifiedDate:i.lastModifiedDate,lastModified:i.lastModified};t&&(o.base64=await NKForm.getFileBase64(i)),r.push(o)}return r},NKForm.getFileBase64=function(n){return new Promise(function(t,r){var e=new FileReader;e.onload=function(e){t(this.result)},e.onerror=function(e){r()},e.readAsDataURL(n)})};let NKHttp={mountGETUrl:function(e,t={}){if(0===Object.keys(t).length)return e;let r=e+"?";for(var n in t)r+=n+"="+encodeURIComponent(t[n])+"&";return r=r.slice(0,-1)},syncGET:function(e,t={},r=!1){e=NKHttp.mountGETUrl(e,t),t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(null),4!==t.readyState||200!==t.status)return{success:!1,data:null,err:t.statusText,status:t.status};{let e=t.responseText;if(r)try{e=JSON.parse(e)}catch(e){return{success:!1,data:t.responseText,err:"Error converting to json.",status:t.status}}return{success:!0,data:e,err:null,status:t.status}}},asyncGET:function(e,t={},n=!1){let i=NKHttp.mountGETUrl(e,t);return new Promise(function(t,e){let r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){let e=r.responseText;if(n)try{e=JSON.parse(e)}catch(e){return void t({success:!1,data:r.responseText,err:"Error converting to json.",status:r.status})}t({success:!0,data:e,err:null,status:r.status})}else t({success:!1,data:null,err:r.statusText,status:r.status})},r.open("GET",i,!0),r.send(null)})}},NKLoader={};if(void 0===NK)throw"You must include NKBase.js before loader.js";NKLoader.setSelector=function(e,n){NKDom.setCss(e,"display","none"),NKDom.setCss(n,"display","none"),window.setInterval(function(){0<$.active?NKDom.setCss(e,"display","block"):($.active=0,NKDom.setCss(e,"display","none"))},500),$(document).ajaxError(function(){$.active=0}),"localhost"!=document.domain&&(window.onerror=function(e,t,r){return $.active=0,NK.isset(n)&&NKDom.setCss(n,"display","block"),console.log("Error: ",e,t,r),!0})};var NKModal={config:{add_close_icon:!0,close_on_click_outside:!0},reload:function(){$(".NKModal .NKCloseIcon").off().on("click",function(){$(this).parents(".NKModal").hide()}),NKModal.config.close_on_click_outside&&$(".NKModal").off().on("click",function(e){e.target===this&&$(this).hide()})},show:function(e){var t,r,n="#"+e;0===$(n).length?console.error("Element "+n+" not found."):(0===(t=$(".NKModal "+n)).length&&(r='<div class="NKModal '+e+'">            <div class="NKContent">                '+(NKModal.config.add_close_icon?'<i class="NKCloseIcon"></i>':"")+"            </div>        </div>",$(n).after(r),$(n).appendTo(".NKModal."+e+" .NKContent"),$(n).show(),NKModal.reload()),$(n).parents(".NKModal").show(),t.show())},hide:function(e){e="#"+e;0!==$(".NKModal "+e).length&&$(e).parents(".NKModal").hide()},toggle:function(e){0!==$(".NKModal #"+e).length&&$("#"+e).parents(".NKModal").is(":visible")?NKModal.hide(e):NKModal.show(e)}},NKNotification={timeout:null};if(void 0===NK)throw"You must include base.js before loader.js";NKNotification.start=function(){var e,t;$("#NKNotification").length<1&&(e=document.createElement("div"),t=document.createElement("div"),e.setAttribute("id","NKNotification"),e.style.display="none",e.innerHTML='<svg onclick="NKNotification.hide()" class="close-icon" xmlns="http://www.w3.org/2000/svg" stroke="black" width="20" height="20" viewBox="0 0 24 24" stroke-width="3" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',t.setAttribute("class","content_wrapper"),e.append(t),document.body.appendChild(e))},NKNotification.show=function(e=["Title","Subtitle"],t=0){clearTimeout(NKNotification.timeout),document.getElementById("NKNotification").style.display="block",$("#NKNotification .content_wrapper").html("");for(var r,n=0;n<e.length;n++)"string"==typeof e[n]?((r=document.createElement("div")).setAttribute("class","content"),0===n&&r.setAttribute("class","content bold"),r.innerHTML=e[n],$("#NKNotification .content_wrapper").append(r)):$("#NKNotification .content_wrapper").append(e[n]);0<t&&(NKNotification.timeout=setTimeout(NKNotification.hide,t))},NKNotification.hide=function(){clearTimeout(NKNotification.timeout),document.getElementById("NKNotification").style.display="none"};let NKObject={clone:function(e){return JSON.parse(JSON.stringify(e))},setValue:function(start_obj,str_obj_path,value){let path_parts=str_obj_path.split("."),aux_path="start_obj";for(let i=0;i<path_parts.length;i++)aux_path+="."+path_parts[i],"undefined"===eval("typeof "+aux_path)&&eval(aux_path+" = {}");eval(aux_path+" = "+JSON.stringify(value))},getValue:function(e,t=void 0){if(void 0===e)return t;if(null==e)return t;if("function"==typeof e)try{return e()}catch(e){return t}return e},getTypeName:function(e){var t=typeof e;return void 0===e?"undefined":"string"==t?"string":"number"==t?"number":"boolean"==t?"boolean":"object"==t&&Array.isArray(e)?"array":"object"==t&&null===e?"null":"object"==t?"object":"unknown"},isType:function(e,t){return NKObject.getTypeName(e)===t}};var NKPopup={};if(void 0===NK)throw"You must include base.js before popup.js";NKPopup.config={allow_hover:!0,mouse_margin:5,box_margin:5},NKPopup.start=function(e){if(!NK.isset(NKPopup.loaded)||!0!==NKPopup.loaded){if(NKPopup.loaded=!0,void 0===NKPosition)throw"You must include position.js";NKPosition.start(),window.addEventListener("load",NKPopup.reload),!0===window.loaded&&NKPopup.reload(),!0===e&&NK.core.reloadOnDomChange(NKPopup)}},NKPopup.reload=function(){$(".NKPopup_dst").hide(),$(".NKPopup_src").off(),$(".NKPopup_src").on("mousemove",function(){var e=$(this).siblings(".NKPopup_dst"),t=NK.isset(e.attr("nk-type"))?e.attr("nk-type"):"box",r=NK.isset(e.attr("nk-align"))?e.attr("nk-align").split(","):["top","center"],n=NK.isset(e.attr("nk-offset"))?e.attr("nk-offset").split(",").map(Number):[0,0],i=NK.isset(e.attr("nk-arrow-size"))?e.attr("nk-arrow-size").split(",").map(Number)[1]:0,o=e.attr("nk-x"),s=e.attr("nk-y"),a=(e.show(),{});if("mouse"===t)var l=[10,22],c=NKPosition.getMouse(),u=NKPopup.config.mouse_margin;else{if("box"!==t)throw"Invalid type: "+t;l=[$(this).outerWidth(),$(this).outerHeight()],c=[$(this).offset().left,$(this).offset().top],u=NKPopup.config.box_margin}if("top"===r[0]||"bottom"===r[0]){if(NK.isset(r[1])&&"center"!==r[1])if("left"===r[1])a={left:c[0]-e.outerWidth()+l[0],top:c[1]-e.outerHeight()-i-u};else{if("right"!==r[1])throw"Invalid param '"+r[1]+"'";a={left:c[0],top:c[1]-e.outerHeight()-i-u}}else a={left:c[0]-e.outerWidth()/2+l[0]/2,top:c[1]-e.outerHeight()-i-u};"bottom"===r[0]&&(a.top+=l[1]+e.outerHeight()+2*i+2*u)}else{if("left"!==r[0]&&"right"!==r[0])throw"Invalid param '"+r[0]+"'";if(NK.isset(r[1])&&"middle"!==r[1])if("top"===r[1])a={left:c[0]-e.outerWidth()-u-i,top:c[1]-e.outerHeight()+l[1]};else{if("bottom"!==r[1])throw"Invalid param '"+r[1]+"'";a={left:c[0]-e.outerWidth()-u-i,top:c[1]}}else a={left:c[0]-e.outerWidth()-u-i,top:c[1]-e.outerHeight()/2+l[1]/2};"right"===r[0]&&(a.left+=l[0]+e.outerWidth()+2*i+2*u)}a.left=a.left+n[0],a.top=a.top+n[1],NK.isset(o)&&(a.left=o),NK.isset(s)&&(a.top=s),e.offset(a)}),$(".NKPopup_src").on("mouseleave",function(){var e=$(this);NKPopup.config.allow_hover?window.setTimeout(function(){0==e.siblings(".NKPopup_dst:hover").length?e.siblings(".NKPopup_dst").hide():e.siblings(".NKPopup_dst:hover").on("mouseleave",function(){$(this).off().hide()})},50):e.siblings(".NKPopup_dst").hide()}),NK.core.ignoreMutations(1),$(".NKPopup_dst").each(function(e){var t,r,n,i,o,s,a;(NK.isset($(this).attr("nk-arrow-size"))||NK.isset($(this).attr("nk-arrow-offset")))&&(t=NK.isset($(this).attr("nk-arrow-size"))?$(this).attr("nk-arrow-size").split(",").map(Number):[10,7],r=NK.isset($(this).attr("nk-offset"))?$(this).attr("nk-offset").split(",").map(Number):[0,0],n=NK.isset($(this).attr("nk-align"))?$(this).attr("nk-align").split(","):["top","center"],i=$(this).siblings(".NKPopup_src"),(o=$(document.createElement("i"))).addClass("NKPopup_arrow_stroke"),$(this).append(o),(s=$(document.createElement("i"))).addClass("NKPopup_arrow_fill"),$(this).append(s),a={border:1,stroke_border:[0,0,0,0],fill_border:[0,0,0,0],stroke_colors:["","","",""],fill_colors:["","","",""],left:[50,50],top:[0,0]},"top"===n[0]?(a.border=parseInt($(this).css("border-bottom-width").split("px")[0]),a.stroke_border=[t[1]+a.border,t[0]/2+a.border,0,t[0]/2+a.border],a.fill_border=[t[1],t[0]/2,0,t[0]/2],a.top=[$(this).innerHeight(),$(this).innerHeight()],a.stroke_colors[0]=$(this).css("border-bottom-color"),a.fill_colors[0]=$(this).css("background-color")):"bottom"===n[0]?(a.border=parseInt($(this).css("border-top-width").split("px")[0]),a.stroke_border=[0,t[0]/2+a.border,t[1]+a.border,t[0]/2+a.border],a.fill_border=[0,t[0]/2,t[1],t[0]/2],a.top=[-1*t[1]-1,-1*t[1]],a.stroke_colors[2]=$(this).css("border-top-color"),a.fill_colors[2]=$(this).css("background-color")):"right"===n[0]?(a.border=parseInt($(this).css("border-left-width").split("px")[0]),a.stroke_border=[t[0]/2+a.border,t[1]+a.border,t[0]/2+a.border,0],a.fill_border=[t[0]/2,t[1],t[0]/2,0],a.stroke_colors[1]=$(this).css("border-left-color"),a.fill_colors[1]=$(this).css("background-color"),a.left[0]=0-t[1]-a.border,a.left[1]=a.left[0]+a.border):"left"===n[0]&&(a.border=parseInt($(this).css("border-right-width").split("px")[0]),a.stroke_border=[t[0]/2+a.border,0,t[0]/2+a.border,t[1]+a.border],a.fill_border=[t[0]/2,0,t[0]/2,t[1]],a.stroke_colors[3]=$(this).css("border-right-color"),a.fill_colors[3]=$(this).css("background-color"),a.left[0]=$(this).innerWidth(),a.left[1]=a.left[0]),"left"===n[1]?(a.left[0]=$(this).outerWidth()-i.outerWidth()/2-t[0]/2-2*a.border,a.left[1]=a.left[0]+a.border):"center"===n[1]?(a.left[0]=$(this).outerWidth()/2-t[0]/2-2*a.border,a.left[1]=a.left[0]+a.border):"right"===n[1]?(a.left[0]=i.outerWidth()/2-t[0]/2-2*a.border,a.left[1]=a.left[0]+a.border):"top"===n[1]?(a.top[0]=$(this).outerHeight()-i.outerHeight()/2-t[0]/2-a.border,a.top[1]=a.top[0]+a.border):"middle"===n[1]?(a.top[0]=$(this).outerHeight()/2-t[0]/2-a.border,a.top[1]=a.top[0]+a.border):"bottom"===n[1]&&(a.top[0]=i.outerHeight()/2-t[0]/2-a.border,a.top[1]=a.top[0]+a.border),a.left[0]-=r[0],a.left[1]-=r[0],a.top[0]-=r[1],a.top[1]-=r[1],o.css("top",a.top[0]).css("left",a.left[0]).css("border-top-width",a.stroke_border[0]).css("border-right-width",a.stroke_border[1]).css("border-bottom-width",a.stroke_border[2]).css("border-left-width",a.stroke_border[3]).css("border-top-color",a.stroke_colors[0]).css("border-right-color",a.stroke_colors[1]).css("border-bottom-color",a.stroke_colors[2]).css("border-left-color",a.stroke_colors[3]),s.css("top",a.top[1]).css("left",a.left[1]).css("border-top-width",a.fill_border[0]).css("border-right-width",a.fill_border[1]).css("border-bottom-width",a.fill_border[2]).css("border-left-width",a.fill_border[3]).css("border-top-color",a.fill_colors[0]).css("border-right-color",a.fill_colors[1]).css("border-bottom-color",a.fill_colors[2]).css("border-left-color",a.fill_colors[3]))})};let NKPosition={},nkposition_event_listener=new NKEventListener;NKPosition={...nkposition_event_listener,start:function(t=!0){!0!==NKPosition.loaded&&(NKPosition.loaded=!0,NKPosition.mouse=[0,0],window.addEventListener("mousemove",function(e){NKPosition.mouse[0]=e.clientX,NKPosition.mouse[1]=e.clientY,t&&NKPosition.dispatchEvent("onMousemove",{abs:NKPosition.mouse,rel:[NKPosition.mouse[0].nksum(window.scrollX),NKPosition.mouse[1].nksum(window.scrollY)]})},!0))},getMouse:function(e=!1){return e?NKPosition.mouse:[NKPosition.mouse[0].nksum(window.scrollX),NKPosition.mouse[1].nksum(window.scrollY)]},getMouseX:function(e=!1){return e?NKPosition.mouse[0]:NKPosition.mouse[0].nksum(window.scrollX)},getMouseY:function(e=!1){return e?NKPosition.mouse[1]:NKPosition.mouse[1].nksum(window.scrollY)},getScroll:function(){return[window.scrollX,window.scrollY]},getScrollX:function(){return window.scrollX},getScrollY:function(){return window.scrollY}};class NKPromise{constructor(){let r=null,n=null;var e=new Promise((e,t)=>{r=e,n=t});return e.resolve=r,e.reject=n,e}}let NKResize={};if(void 0===NK)throw"You must include base.js before context_menu.js";let nkresize_event_listener=new NKEventListener;NKResize={...nkresize_event_listener,config:{column_resize_cursor:"col-resize",row_resize_cursor:"row-resize"},start:function(e){if(!0!==NKResize.loaded){if(NKResize.loaded=!0,"undefined"==typeof NKDom)throw"You must include NKDom.js";if(void 0===NKPosition)throw"You must include NKPosition.js";NKPosition.start(),window.addEventListener("load",NKResize.reload),!0===window.loaded&&NKResize.reload(),!0===e&&NK.core.reloadOnDomChange(NKResize)}},reload:function(){var e=NKDom.select(".NKResize_columns"),t=NKDom.select(".NKResize_rows");function c(e,t,r,n){let i=[];var o=[],s=parseInt(NKDom.getAttribute(t,"nk-i"));if(s===(i=(n?NKDom.getCss(e,"grid-template-columns"):NKDom.getCss(e,"grid-template-rows")).split(" ")).length-1)return i.join(" ");for(let e=0;e<i.length;e++)e===s?o.push(r+"px"):e===s+1?o.push("auto"):o.push(i[e]);return o}function r(e){var t=this.getBoundingClientRect(),t=[t.left,t.top],n=NKPosition.getMouse(),t=[n[0]-t[0],n[1]-t[1]],i=[this.clientWidth,this.clientHeight],r=i[0]-5<=t[0],t=i[1]-5<=t[1],o=this===this.parentNode.lastElementChild,e=e.type;if("mousedown"===e)r&&!o&&(NKResize.resizing_vertical_element=this,NKResize.start_columns=NKDom.getCss(this.parentNode,"grid-template-columns").split(" "),NKResize.start_pos=n,NKResize.start_size=i,NKDom.addClass(NKDom.getChildren(NKDom.getChildren(".NKResize_columns","div")),"NKResize_disable_temp")),t&&!o&&(NKResize.resizing_horizontal_element=this,NKResize.start_rows=NKDom.getCss(this.parentNode,"grid-template-rows").split(" "),NKResize.start_pos=n,NKResize.start_size=i,NKDom.addClass(NKDom.getChildren(NKDom.getChildren(".NKResize_rows","div")),"NKResize_disable_temp"));else if("mousemove"===e){var i=NKResize.resizing_vertical_element,s=NKResize.resizing_horizontal_element;if(null!==i){var a=i.parentNode,l=parseInt(NKDom.getCss(i,"border-right-width"));let r=c(a,i,NKResize.start_size[0]+(n[0]-NKResize.start_pos[0])+l,!0);NKDom.setCss(a,"grid-template-columns",r.join(" ")),NKDom.getChildren(a,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-width",r[t])}),NKDom.setCss(this,"cursor",NKResize.config.column_resize_cursor)}else if(null!==s){var i=s.parentNode,l=parseInt(NKDom.getCss(s,"border-bottom-width"));let r=c(i,s,NKResize.start_size[1]+(n[1]-NKResize.start_pos[1])+l,!1);NKDom.setCss(i,"grid-template-rows",r.join(" ")),NKDom.getChildren(i,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-height",r[t])}),NKDom.setCss(this,"cursor",NKResize.config.row_resize_cursor)}else r&&!o&&NKDom.hasClass(this.parentNode,"NKResize_columns")?NKDom.setCss(this,"cursor",NKResize.config.column_resize_cursor):t&&!o&&NKDom.hasClass(this.parentNode,"NKResize_rows")?NKDom.setCss(this,"cursor",NKResize.config.row_resize_cursor):NKDom.setCss(this,"cursor","")}else"mouseup"===e&&(a=NKResize.resizing_vertical_element,s=NKResize.resizing_horizontal_element,null!==a&&(n=NKDom.getCss(a.parentNode,"grid-template-columns").split(" "),l=parseInt(NKDom.getAttribute(a,"nk-i")),NKResize.dispatchEvent("onResize",{start:NKResize.start_columns,end:n,i:l,e:a,parent:a.parentNode}),NKDom.removeClass(NKDom.getChildren(NKDom.getChildren(".NKResize_columns","div")),"NKResize_disable_temp")),null!==s&&(i=NKDom.getCss(s.parentNode,"grid-template-rows").split(" "),r=parseInt(NKDom.getAttribute(s,"nk-i")),NKResize.dispatchEvent("onResize",{start:NKResize.start_rows,end:i,i:r,e:s,parent:s.parentNode}),NKDom.removeClass(NKDom.getChildren(NKDom.getChildren(".NKResize_rows","div")),"NKResize_disable_temp")),NKResize.resizing_vertical_element=null,NKResize.resizing_horizontal_element=null,NKDom.setCss(this,"cursor",""))}e.forEach(function(e,t){let r=[];NKDom.getChildren(e,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-i",t),NKDom.setCss(e,"overflow","hidden");t=NKDom.getAttribute(e,"nk-width"),t=NK.empty(t)?"auto":t;r.push(t)}),NKDom.setCss(e,"display","grid"),NKDom.setCss(e,"grid-template-columns",r.join(" ")),NKDom.setCss(e,"overflow","hidden")}),t.forEach(function(e,t){let r=[];NKDom.getChildren(e,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-i",t),NKDom.setCss(e,"overflow","hidden");t=NKDom.getAttribute(e,"nk-height"),t=NK.empty(t)?"auto":t;r.push(t)}),NKDom.setCss(e,"display","grid"),NKDom.setCss(e,"grid-template-rows",r.join(" ")),NKDom.setCss(e,"overflow","hidden")}),NKResize.resizing_vertical_element=null,NKResize.resizing_horizontal_element=null,NKDom.addEventListener(".NKResize_columns","mouseleave",function(){NKResize.resizing_vertical_element=null,NKDom.setCss(this,"cursor","")}),NKDom.addEventListener(".NKResize_rows","mouseleave",function(){NKResize.resizing_horizontal_element=null,NKDom.setCss(this,"cursor","")}),NKDom.addEventListener(NKDom.getChildren(".NKResize_columns","div"),"mousemove",r),NKDom.addEventListener(NKDom.getChildren(".NKResize_columns","div"),"mousedown",r),NKDom.addEventListener(NKDom.getChildren(".NKResize_columns","div"),"mouseup",r),NKDom.addEventListener(NKDom.getChildren(".NKResize_rows","div"),"mousemove",r),NKDom.addEventListener(NKDom.getChildren(".NKResize_rows","div"),"mousedown",r),NKDom.addEventListener(NKDom.getChildren(".NKResize_rows","div"),"mouseup",r)}};var NKRouting={routes:[],get_url:function(){return[window.location.protocol+"//",window.location.host,window.location.pathname.split("/").slice(0,-1).join("/")+"/",window.location.pathname.split("/").pop(),window.location.search]},set_routes:function(e){NKRouting.routes[e.router_name]=e,NK.isset(e.default_section)&&$(document).ready(function(){NKRouting.go(e.router_name,e.default_section)})},go:function(e,t){var r;NK.isset(NKRouting.routes[e])?(r=NKRouting.routes[e].sections[t],NK.isset(r)?NK.isset(r.get)?NKRouting._perform_get(e,t):NK.isset(r.show)&&NKRouting._perform_show(e,t):console.error("Routes for",e,"->",t,"not set.")):console.error("Routes for",e,"not set.")},_perform_show:function(e,t){var r=NKRouting.routes[e].container,n=NKRouting.routes[e].sections;if(NK.isset(r)){if(!NK.isset(n[t].content))for(var i in n)n[i].content=$(n[i].show).html(),$(n[i].show).html("");NKRouting._replace_content(e,t)}else{for(var i in n)$(n[i].show).hide();$(n[t].show).show()}NKRouting._run_controller(e,t)},_perform_get:function(t,r){var n=NKRouting.routes[t].sections[r];NK.isset(n.loading)||(NK.isset(n.content)?(NKRouting._replace_content(t,r),NKRouting._run_controller(t,r)):(n.loading=!0,$.ajax({url:n.get,success:function(e){n.content=e,NKRouting._replace_content(t,r),delete n.loading,NKRouting._run_controller(t,r)}})))},_replace_content:function(e,t){var r=NKRouting.routes[e].container,n=NKRouting.routes[e].sections[t].content;NKRouting.routes[e].sections[t].ctrl;$(r).html(n)},_run_controller:function(router_name,section){var router=NKRouting.routes[router_name],ruta=NKRouting.routes[router_name].sections[section],controller_init=ruta.ctrl+".init",controller_enter=ruta.ctrl+".enter",last_controller,first_time;NK.isset(router.last_section)&&(last_controller=NKRouting.routes[router_name].sections[router.last_section].ctrl,NK.isset(last_controller))&&"function"===eval("typeof "+last_controller+".leave")&&eval(last_controller+".leave()"),router.last_section=section,NK.isset(ruta.ctrl)&&(first_time=!NK.isset(ruta.loaded),ruta.loaded=!0,first_time&&"function"===eval("typeof "+controller_init)&&eval(controller_init+"()"),"function"===eval("typeof "+controller_enter))&&eval(controller_enter+"()")}};class NKSemaphore{constructor(e){this.max=e,this.count=e,this.waitingQueue=[],this.waitingEmptyQueue=[]}async acquire(){0<this.count?this.count--:await new Promise(e=>this.waitingQueue.push(e))}async wait(){this.count!==this.max&&await new Promise(e=>this.waitingEmptyQueue.push(e))}release(){if(0<this.waitingQueue.length?this.waitingQueue.shift()():this.count<this.max&&this.count++,this.count===this.max)for(;0<this.waitingEmptyQueue.length;)this.waitingEmptyQueue.shift()()}}let NKSerialize={debug:!1},NKUnserialize={},NKStick=(NKSerialize.number_types={integer_positive:0,integer_negative:1,float_positive:2,float_negative:3},NKSerialize.types={null:4,undefined:5,number:6,number_array:7,string:8,string_array:9,boolean:10,object:11,object_array:12,sub_object:13,mix_array:14},NKSerialize.integer=function(e){if(e<0)throw new Error("El nmero debe ser positivo.");NKSerialize.debug&&console.log("Src num: ",e);let t=e.toString(2);NKSerialize.debug&&console.log("Src num bin: ",t);var e=15*Math.ceil(t.length/15),r=(t=t.padStart(e,"0"),[]);for(let e=0;e<t.length;e+=15)r.push("0"+t.substring(e,e+15));r[r.length-1]="1"+r[r.length-1].slice(1),NKSerialize.debug&&console.log("Src num bin splitted: ",r);let n="";for(let e=0;e<r.length;e++)r[e]=parseInt(r[e],2),n+=String.fromCharCode(r[e]);return n},NKUnserialize.integer=function(e){let t="";var r=[];let n=0;for(n=0;n<e.length;n++){var i=e[n].charCodeAt(0).toString(2).padStart(16,"0");if(r.push(i),t+=i.slice(-15),"1"===i[0])break}return NKSerialize.debug&&console.log("Dst num bin splitted: ",r),NKSerialize.debug&&console.log("Dst num bin: ",t),t=parseInt(t,2),NKSerialize.debug&&console.log("Dst num: ",t),{value:t,len:n+1}},NKSerialize.boolean=function(e,t=!1){e=e?1:0;return t?NKSerialize.integer(NKSerialize.types.boolean)+NKSerialize.integer(e):NKSerialize.integer(e)},NKUnserialize.boolean=function(e){e=NKUnserialize.integer(e);return{value:0!==e.value,len:e.len}},NKSerialize.string=function(e,t=!1){return t?NKSerialize.integer(NKSerialize.types.string)+NKSerialize.integer(e.length)+e:NKSerialize.integer(e.length)+e},NKUnserialize.string=function(e){var t=NKUnserialize.integer(e);return{value:e.slice(t.len,t.len+t.value),len:t.len+t.value}},NKSerialize.array=function(t,r=null,e=!1){let n=NKObject.getTypeName(t[0]);var i=t.every(e=>NKObject.getTypeName(e)===n);let o=NKSerialize.types.mix_array;i&&0<t.length&&("string"===n?o=NKSerialize.types.string_array:"number"===n?o=NKSerialize.types.number_array:"object"===n?o=NKSerialize.types.object_array:console.error("Error, unknown type:",t[0],n));var s=o===NKSerialize.types.mix_array;let a="";e&&(a+=NKSerialize.integer(o)),a+=NKSerialize.integer(t.length);for(let e=0;e<t.length;e++)NKObject.isType(t[e],"object")&&null===r?a+=NKSerialize.object(t[e],s):a+=NKSerialize.byType(t[e],s,r);return a},NKUnserialize.mixArray=function(e,t){var r=[];let n=0,i=0;var o=NKUnserialize.integer(e);for(n+=o.len;i++<o.value;){var s=NKUnserialize.byType(e.slice(n),t);r.push(s.value),n+=s.len}return{value:r,len:n}},NKUnserialize.objectArray=function(t,r=null){var n=[];let i=0,e=0;var o=NKUnserialize.integer(t);for(i+=o.len;e++<o.value;){let e=null;e=null===r?NKUnserialize.object(t.slice(i)):NKUnserialize.sub_object(t.slice(i),r),n.push(e.value),i+=e.len}return{value:n,len:i}},NKSerialize.stringArray=function(e,t=!1){return NKSerialize.array(e,null,t)},NKUnserialize.stringArray=function(e){var t=[];let r=0,n=0;var i=NKUnserialize.integer(e);for(r+=i.len;n++<i.value;){var o=NKUnserialize.string(e.slice(r));t.push(o.value),r+=o.len}return{value:t,len:r}},NKSerialize.number=function(e,t=!1){NaN!==e&&e!==1/0&&e!==-1/0||(e=0),isNaN(e)&&(console.error("Error, value (",e,") is not a number."),e=0);let r="";var n;return r=Number.isInteger(e)?0<=e?NKSerialize.integer(NKSerialize.number_types.integer_positive)+NKSerialize.integer(e):NKSerialize.integer(NKSerialize.number_types.integer_negative)+NKSerialize.integer(-e):((n=(e+"").split("."))[0]=parseInt(n[0]),n[1]=parseInt(n[1]),0<=e?NKSerialize.integer(NKSerialize.number_types.float_positive)+NKSerialize.integer(n[0])+NKSerialize.integer(n[1]):NKSerialize.integer(NKSerialize.number_types.float_negative)+NKSerialize.integer(-n[0])+NKSerialize.integer(n[1])),r=t?NKSerialize.integer(NKSerialize.types.number)+r:r},NKUnserialize.number=function(e){var t=NKUnserialize.integer(e),r=(e=e.slice(t.len),NKUnserialize.integer(e));if(t.value===NKSerialize.number_types.integer_positive)return{value:r.value,len:t.len+r.len};if(t.value===NKSerialize.number_types.integer_negative)return{value:-r.value,len:t.len+r.len};e=e.slice(r.len);var e=NKUnserialize.integer(e),n=parseFloat(r.value+"."+e.value);return t.value===NKSerialize.number_types.float_positive?{value:n,len:t.len+r.len+e.len}:t.value===NKSerialize.number_types.float_negative?{value:-n,len:t.len+r.len+e.len}:void 0},NKSerialize.numberArray=function(e,t=!1){return NKSerialize.array(e,null,t)},NKUnserialize.numberArray=function(e){var t=[];let r=0,n=0;var i=NKUnserialize.integer(e);for(r+=i.len;n++<i.value;){var o=NKUnserialize.number(e.slice(r));t.push(o.value),r+=o.len}return{value:t,len:r}},NKSerialize.byType=function(e,t,r=[]){return NKObject.isType(e,"undefined")?t?NKSerialize.integer(NKSerialize.types.undefined):"":NKObject.isType(e,"string")?NKSerialize.string(e,t):NKObject.isType(e,"number")?NKSerialize.number(e,t):NKObject.isType(e,"boolean")?NKSerialize.boolean(e,t):NKObject.isType(e,"array")?NKSerialize.array(e,r,t):NKObject.isType(e,"null")?t?NKSerialize.integer(NKSerialize.types.null):"":NKObject.isType(e,"object")?NKSerialize.sub_object(e,r,t):NKSerialize.string("Not implemented (Unknown type)",e)},NKSerialize.sub_object=function(t,r=[],e=!1){let n="";var i=Object.keys(t),o=(i.sort(),NKSerialize.stringArray(i));let s=r.indexOf(o);-1===s&&(r.push(o),s=r.length-1),e&&(n+=NKSerialize.integer(NKSerialize.types.sub_object)),n+=NKSerialize.integer(s);var a=[];for(let e=0;e<i.length;e++)a.push(t[i[e]]);for(let e=0;e<a.length;e++)a[e]=NKSerialize.byType(a[e],!0,r);return n+=a.join("")},NKSerialize.object=function(e,t=!1){var r=[],e=NKSerialize.sub_object(e,r);let n="";return t&&(n+=NKSerialize.integer(NKSerialize.types.object)),n=(n+=NKSerialize.integer(r.length))+r.join("")+e},NKUnserialize.byType=function(e,t=[]){var r=NKUnserialize.integer(e);let n={value:null,len:null};return[NKSerialize.types.number].includes(r.value)?n=NKUnserialize.number(e.slice(r.len)):r.value===NKSerialize.types.boolean?n=NKUnserialize.boolean(e.slice(r.len)):r.value===NKSerialize.types.string?n=NKUnserialize.string(e.slice(r.len)):r.value===NKSerialize.types.string_array?n=NKUnserialize.stringArray(e.slice(r.len)):r.value===NKSerialize.types.number_array?n=NKUnserialize.numberArray(e.slice(r.len)):r.value===NKSerialize.types.sub_object?n=NKUnserialize.sub_object(e.slice(r.len),t):r.value===NKSerialize.types.object_array?n=NKUnserialize.objectArray(e.slice(r.len),t):r.value===NKSerialize.types.mix_array?n=NKUnserialize.mixArray(e.slice(r.len),t):r.value===NKSerialize.types.null?n={value:null,len:0}:r.value===NKSerialize.types.undefined?n={value:void 0,len:0}:console.error("Unknown type "+r.value),{type:r.value,value:n.value,len:r.len+n.len}},NKUnserialize.sub_object=function(t,r){let n=0;var e=NKUnserialize.integer(t.slice(n)),i=(n+=e.len,r[e.value]),o={};for(let e=0;e<i.length;e++){var s=i[e],a=NKUnserialize.byType(t.slice(n),r);o[s]=a.value,n+=a.len}return{value:o,len:n}},NKUnserialize.object=function(t){let r=0;var n=NKUnserialize.integer(t),i=(r+=n.len,[]);for(let e=0;e<n.value;e++){var o=NKUnserialize.stringArray(t.slice(r));r+=o.len,i.push(o.value)}var e=NKUnserialize.sub_object(t.slice(r),i);return{value:e.value,len:e.len+r}},{});if(void 0===NK)throw"You must include base.js before stick.js";NKStick.start=function(){NK.isset(NKStick.loaded)&&!0===NKStick.loaded||(NKDom.select(".NKStickBD").forEach(function(e,t){NKDom.setAttribute(e,"nkdata-top",e.offsetTop)}),window.addEventListener("load",NKStick.reload),window.addEventListener("resize",NKStick.reload),window.addEventListener("scroll",NKStick.reload),NKStick.loaded=!0)},NKStick.reload=function(){var e=document.documentElement.scrollHeight>window.innerHeight;let n=document.documentElement.scrollTop;e?NKDom.removeClass(".NKStickBN","NKStickBO"):NKDom.addClass(".NKStickBN","NKStickBO"),e&&(NKDom.removeClass(".NKStickBD","NKStickBO"),NKDom.select(".NKStickBD").forEach(function(e,t){n+window.innerHeight<e.offsetTop+e.clientHeight&&NKDom.addClass(".NKStickBD","NKStickBO")}),NKDom.removeClass(".NKStickTD","NKStickTO"),NKDom.select(".NKStickTD").forEach(function(e,t){var r;"fixed"===NKDom.getCss(e,"position")?(r=parseInt(NKDom.getCss(e,"top")),n<r?NKDom.setCss(e,"margin-top",-n):NKDom.setCss(e,"margin-top",-r)):n>e.offsetTop&&NKDom.addClass(".NKStickTD","NKStickTO")}))};var NKStorage={};if(void 0===NK)throw"You must include base.js before storage.js";var nkstorage_event_listener=new NKEventListener,NKStorage={...nkstorage_event_listener,p:null,np:null,save:function(e){!0===e||NKStorage.is_safari?(localStorage.setItem("NKStorage",JSON.stringify(NKStorage.p)),sessionStorage.setItem("NKStorage",JSON.stringify(NKStorage.np)),NKStorage.saveOnLeave=!1):NKStorage.saveOnLeave=!0},start:function(e=!0){if(NKStorage.saveOnLeave=e,!NK.isset(NKStorage.loaded)||!0!==NKStorage.loaded){NKStorage.is_safari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);try{NKStorage.p=JSON.parse(localStorage.getItem("NKStorage"))}catch(e){}NK.isset(NKStorage.p)||(localStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.p=JSON.parse("{}"));try{NKStorage.np=JSON.parse(sessionStorage.getItem("NKStorage"))}catch(e){}NK.isset(NKStorage.np)||(sessionStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.np=JSON.parse("{}")),NKStorage.loaded=!0}},clear:function(){localStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.p=JSON.parse("{}"),sessionStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.np=JSON.parse("{}")},broadcast:function(e){var t,r=e.split("."),n=[];for(t in r)n.push(r[t]),NKStorage.dispatchEvent(n.join("."))},listen:function(e,t){NKStorage.addEventListener(e,t)}};NKStorage.oldLeaveHandler=window.onbeforeunload,window.onbeforeunload=function(e){NKStorage.oldLeaveHandler&&NKStorage.oldLeaveHandler(e),!0===NKStorage.saveOnLeave&&NKStorage.save(!0)};let NKString={capitalize:function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}},NKVar=(String.prototype.nkCapitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1).toLowerCase()},NKString.normalizeSpaces=function(e){return e.replace(/\s+/g," ").trim()},String.prototype.nkNormalizeSpaces=function(){return this.replace(/\s+/g," ").trim()},NKString.deleteAllSpaces=function(e){return e.replace(/\s+/g,"")},String.prototype.nkDeleteAllSpaces=function(){return this.replace(/\s+/g,"")},NKString.htmlEntities={"&Aacute;":"","&Eacute;":"","&Iacute;":"","&Oacute;":"","&Uacute;":"","&Ntilde;":"","&Uuml;":"","&aacute;":"","&eacute;":"","&iacute;":"","&oacute;":"","&uacute;":"","&ntilde;":"","&uuml;":"","&nbsp;":" ","&iexcl;":"","&iquest;":"","&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&apos;":"'","&#37;":"%","&reg;":"","&deg;":"","&micro;":""},NKString.decodeHtmlEntities=function(e){try{return e.replace(/&[a-zA-Z0-9#]+;/g,e=>NKString.htmlEntities[e]||e)}catch(e){}return e},String.prototype.nkDecodeHtmlEntities=function(){try{return this.replace(/&[a-zA-Z0-9#]+;/g,e=>NKString.htmlEntities[e]||e)}catch(e){}return this},NKString.removeAccents=function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")},String.prototype.nkRemoveAccents=function(){return this.normalize("NFD").replace(/[\u0300-\u036f]/g,"")},{isset:function(e){if(void 0===e)return!1;if(null==e)return!1;if("function"==typeof e)try{e()}catch(e){return!1}return!0},empty:function(e){return!NK.isset(e)||0===(e="function"==typeof e?e():e).length}});var NKWebsocketClient=function(e,t){this.host=e,this.port=t,this.socket=null,this.writePromises={},this.connect=function(){let i=this;this.socket=new WebSocket("ws://"+this.host+":"+this.port),this.socket.addEventListener("open",e=>this.onOpen(e)),this.socket.addEventListener("close",e=>this.onClose(e)),this.socket.addEventListener("error",e=>this.onError(e)),this.socket.addEventListener("message",e=>{let t=e.data.toString(),r=t.charCodeAt(0),n=t.charCodeAt(1);t=t.substring(2),0===r?this.onMessage(t,function(e){i.socket.send(String.fromCharCode(r)+String.fromCharCode(n)+e)},e):(this.writePromises[r](t),delete this.writePromises[r])})},this.connected=function(){return this.socket.readyState!==WebSocket.CLOSED},this.reconnect=async function(){for(;!this.connected();)this.connect(),await NK.sleep(5e3)},this.write=function(e){this.socket.send(String.fromCharCode(0)+String.fromCharCode(0)+e)},this.writeAndWait=function(e,r){let n=this,i=0;var t;for(let e=1;e<255;e++)if(void 0===this.writePromises[e]){i=e;break}return 0===i?new Promise(function(e,t){t("Error, too many writeAndWait")}):(t=new Promise(function(e,t){n.writePromises[i]=e,setTimeout(function(){t("Timeout")},r)}),this.socket.send(String.fromCharCode(i)+String.fromCharCode(0)+e),t)},this.onOpen=function(e){},this.onMessage=function(e,t,r){},this.onClose=function(e){},this.onError=function(e){}};