var NK={};function NKEventListener(){this.events={},this.addEventListener=function(e,t){NK.isset(this.events[e])||(this.events[e]=[]),this.events[e].push(t)},this.removeEventListener=function(e,t){for(var o=0;o<this.events[e].length;o++)if(this.events[e][o]===t){this.events[e].splice(o,1);break}},this.dispatchEvent=function(e,t){if(NK.isset(this.events[e]))for(var o=0;o<this.events[e].length;o++)(0,this.events[e][o])(t)}}NK.isset=function(e){if(void 0===e)return!1;if(null==e)return!1;if("function"==typeof e)try{e()}catch(e){return!1}return!0},NK.empty=function(e){return!NK.isset(e)||0===(e="function"==typeof e?e():e).length},NK.clone=function(e){return console.error("NK.clone() deprecated, use NKObject.clone() instead."),JSON.parse(JSON.stringify(e))},NK.backtrace=function(e=""){var t=(new Error).stack.split("\n").slice(2).join("\n");console.log("Backtrace: "+e+"\n"+t)},NK.getScriptPath=function(){var e=document.querySelectorAll("script"),e=e[e.length-1].src;return e.substring(8,e.lastIndexOf("/"))},NK.sleep=function(t){return new Promise(e=>{setTimeout(e,t)})},NK.core={},NK.core.reloadOnDomChange=function(e){NK.isset(NK.core.reactableModules)||(NK.core.reactableModules=[]),NK.core.reactableModules.push(e),NK.isset(NK.core.MutationObserver)||(MutationObserver=window.MutationObserver||window.WebKitMutationObserver,NK.core.MutationObserverOffset=1,NK.core.MutationObserver=new MutationObserver(function(e,t){if(0<NK.core.MutationObserverOffset)NK.core.MutationObserverOffset--;else for(var o=0;o<NK.core.reactableModules.length;o++)void 0!==NK.core.reactableModules[o].reload&&NK.core.reactableModules[o].reload()}),NK.core.MutationObserver.observe(document,{subtree:!0,childList:!0}))},NK.core.ignoreMutations=function(e){NK.isset(NK.core.MutationObserver)&&(NK.core.MutationObserverOffset+=e)},window.addEventListener("load",function(){if(!NK.isset(()=>window.$))throw"Error, you must include jquery before using NKLibsJS";window.loaded=!0});var NKActions={};if(void 0===NK)throw"You must include base.js before actions.js";NKActions.start=function(e){NK.isset(NKActions.loaded)&&!0===NKActions.loaded||(window.addEventListener("load",NKActions.reload),!0===window.loaded&&NKActions.reload(),!0===e&&NK.core.reloadOnDomChange(NKActions),NKActions.loaded=!0)},NKActions.reload=function(){function t(e,t){var o=$(e).html();0<(o=o.toLowerCase().startsWith("hide")||o.toLowerCase().startsWith("show")?o.substring(4):o).length&&!o.startsWith(" ")&&(o=" "+o),t.is(":visible")?$(e).html("Hide"+o):$(e).html("Show"+o),console.log("entra")}$(".NKHide_btn").off().on("click",function(){$(this).closest(".NKHide_dst").hide()}),$(".NKDel_btn").off().on("click",function(){$(this).closest(".NKDel_dst").remove()}),$(".NKToggle_btn").off().on("click",function(){var e=$(this).siblings(".NKToggle_dst");e.toggle(),$(this).hasClass("NKReact")&&t(this,e)}),$(".NKToggle_btn.NKReact").each(function(){t(this,$(this).siblings(".NKToggle_dst"))})};let NKArray={clone:function(e){return JSON.parse(JSON.stringify(e))}};NKArray.getCombinations=function(){if("string"!=typeof arguments[0])return console.error("First argument must be a string."),[];let r=arguments[0];var t=[];for(let e=1;e<arguments.length;e++){if(!Array.isArray(arguments[e]))return console.error("One of the parameters is not an array."),[];t.push(arguments[e])}function e(e,n){return e.reduce(function(e,t,o){return""+e+n[o][t]+r},"")}var o=new Array(t.length).fill(0),n=[];let i=e(o,t);for(n.push(i.slice(0,-1));function(t,o){for(let e=t.length-1;0<=e;e--){var n=o[e].length-1;if(t[e]+1<=n)return t[e]++,1;if(e-1<0)return;t[e]=0}}(o,t);)i=e(o,t),n.push(i.slice(0,-1));return n},NKArray.mountTree=function(t,o,n,r){var i={},s=[];for(let e=0;e<t.length;e++)void 0===i[t[e][o]]&&(i[t[e][o]]={},i[t[e][o]][r]=[]),void 0===i[t[e][n]]&&(i[t[e][n]]={},i[t[e][n]][r]=[]),i[t[e][o]]={...t[e],...i[t[e][o]]},(0===parseInt(t[e][n])?s:i[t[e][n]][r]).push(i[t[e][o]]);return s};var NKCanvas={getPixelColor:function(e,t,o){t=parseFloat(t),o=parseFloat(o);var n=e.getContext("2d").getImageData(0,0,e.width,e.height,{willReadFrequently:!0}).data,e=4*(e.width*o+t);return{rgba:[n[e],n[1+e],n[2+e],n[3+e]]}},searchPixelCoords:function(e,t=[0,0,0]){for(var o=e.getContext("2d"),n=e.width,r=o.getImageData(0,0,e.width,e.height).data,i=-1,s=0;s<r.length;s+=4)if(r[s]===t[0]&&r[s+1]===t[1]&&r[s+2]===t[2]){i=s;break}o=i/4;return{x:o%n,y:Math.floor(o/n)}},extractPortion:function(e,t,o,n,r,i={}){var s=document.createElement("canvas"),i=s.getContext("2d",i);return s.hidden=!0,s.width=n,s.height=r,i.drawImage(e,t,o,n,r,0,0,n,r),s},replaceColor:function(e,t,o){var n=e.getContext("2d"),e=n.getImageData(0,0,e.width,e.height),r=e.data,i=0;if(4===t.length&&4===o.length)for(var s=0;s<r.length;s+=4)r[s]===t[0]&&r[s+1]===t[1]&&r[s+2]===t[2]&&r[s+3]===t[3]&&(r[s]=o[0],r[s+1]=o[1],r[s+2]=o[2],r[s+3]=o[3],i++);else for(s=0;s<r.length;s+=4)r[s]===t[0]&&r[s+1]===t[1]&&r[s+2]===t[2]&&(r[s]=o[0],r[s+1]=o[1],r[s+2]=o[2],i++);return n.putImageData(e,0,0),i},compare:function(e,t){var o=e.getContext("2d"),n=t.getContext("2d"),r=e.width,i=e.height;if(e.width!==t.width||e.height!==t.height)return console.error("Los canvas tienen dimensiones diferentes.");for(var e=o.getImageData(0,0,r,i),t=n.getImageData(0,0,r,i),s=e.data,a=t.data,l=[],c=0;c<s.length;c+=4){var u,d,N=s.slice(c,c+4),f=a.slice(c,c+4);d=f,(u=N)[0]===d[0]&&u[1]===d[1]&&u[2]===d[2]&&u[3]===d[3]||(u=c/4%r,d=Math.floor(c/4/r),l.push({x:u,y:d,color_1:N,color_2:f}))}return l}},NKCast={};if(void 0===NK)throw"You must include base.js before cast.js";NKCast.intByteArray={toUtf8String:function(e){for(var t="",o=0;o<e.length;o++)(e[o]<0||255<e[o])&&console.error("Error NKCast.intByteArray.toUtf8String(): ("+e[o]+") Out of range [0..255]"),t+=String.fromCharCode(e[o]);return t},toUtf16String:function(e){return NKCast.intByteArray.toUtf8String(e)},toHexString:function(e,t,o){if(!NK.isset(e))return"";for(var n="",r=0;r<e.length;r++)o&&0!=r&&(n+=" "),n+=NKCast.intByte.toHexString(e[r],t);return n},toInt:function(e){for(var t=0,o=1,n=e.length-1;0<=n;n--)(e[n]<0||255<e[n])&&console.error("Error NKCast.intByteArray.toUtf16String(): ("+e[n]+") Out of range [0..255]"),t+=e[n]*o,o*=256;return t}},NKCast.intByte={toHexString:function(e,t){return(e<0||255<e)&&console.error("Error NKCast.intByte.toHexString(): ("+e+") Out of range [0..255]"),t?"0x"+e.toString(16):e.toString(16)}},NKCast.utf16String={toIntByteArray:function(e){for(var t="",o=0;o<e.length;o++)t+=e.charCodeAt(o);return t}},NKCast.utf8String={toIntByteArray:function(e){return NKCast.utf16String.toIntByteArray(e)}};var NKClipboard={set:function(e){var t=document.createElement("textarea"),e=(t.style.position="absolute",t.style.left="-10000px",t.readonly=!0,t.value=e,document.body.appendChild(t),0<document.getSelection().rangeCount&&document.getSelection().getRangeAt(0));t.select(),document.execCommand("copy"),document.body.removeChild(t),e&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(e))},get:function(){return navigator.clipboard.readText()}},NKContextMenu={};if(void 0===NK)throw"You must include base.js before context_menu.js";var nkcontextmenu_event_listener=new NKEventListener,NKContextMenu={...nkcontextmenu_event_listener,start:function(){if(!NK.isset(NKContextMenu.loaded)||!0!==NKContextMenu.loaded){if(NKContextMenu.loaded=!0,void 0===NKPosition)throw"You must include position.js";if(null===document.body)throw"The <body> tag must be fully loaded before calling NKContextMenu.start()";NKPosition.start(),$("#NKContextMenu").length<1&&((e=document.createElement("div")).setAttribute("id","NKContextMenu"),document.body.appendChild(e)),$("#NKContextMenu").hide();var e,o=null;document.addEventListener("contextmenu",function(e){var t=e.target;o=t,NKContextMenu.dispatchEvent("onOpen",{target:t}),0===$("#NKContextMenu").children().length?$("#NKContextMenu").hide():($("#NKContextMenu").show(),$("#NKContextMenu .NKSubmenu").hide(),$("#NKContextMenu").css("left",NKPosition.getMouseX()),$("#NKContextMenu").css("top",NKPosition.getMouseY()),e.preventDefault())}),document.addEventListener("mouseup",function(e){2!==e.button&&$("#NKContextMenu").is(":visible")&&(e=e.target,$(e).hasClass("NKItem")?NKContextMenu.dispatchEvent("onClose",{id:e.getAttribute("data-id"),text:$(e).children(".NKTitle").text(),target:o,button:e}):NKContextMenu.dispatchEvent("onClose",{id:null,target:o,button:null}),$("#NKContextMenu").hide())}),NKContextMenu.refresh()}}};NKContextMenu.setContent=function(e){var t=[];function s(e,t,o,n){var r=$(document.createElement("div")),i=$(document.createElement("div")),s=$(document.createElement("div"));return r.addClass("NKItem"),i.addClass("NKIcon"),s.addClass("NKTitle"),r.attr("data-id",e),s.text(t),NK.empty(o)||(i.append(o),i.css("margin-right","5px")),r.append(i),r.append(s),null!==n&&((e=$(document.createElement("div"))).addClass("NKSubmenu"),e.append(n),r.addClass("NKArrow"),r.append(e)),r}NK.empty(e)||(t=function e(t){for(var o=[],n=0;n<t.length;n++){var r,i=t[n];"item"===i.type?o.push(s(i.id,i.text,i.icon,null)):"menu"===i.type?(r=e(i.items),o.push(s(i.id,i.text,i.icon,r))):"divider"===i.type&&((r=$(document.createElement("div"))).addClass("NKDivider"),o.push(r))}return o}(e));e=$("#NKContextMenu");e.empty(),e.append(t),NKContextMenu.refresh()},NKContextMenu.refresh=function(){$(".NKItem").off(),$(".NKSubmenu").hide(),$(".NKItem").on("mouseenter",function(){var e=$(this),t=($(this).parent().find(".NKSubmenu").hide(),$(this).children(".NKSubmenu"));1===t.length&&(t.show(),t.css("left",e.width()+30))})};let NKDate={set:function(e,t=null,o=null,n=null,r=null,i=null,s=null,a=null){return e.setTime(new Date(n,o-1,t,r,i,s,a).getTime()),e},clone:function(e){return new Date(e.getTime())},setFromString:function(t,e,o){var n=e.split(/(?:\/|-| |:|\\)+/),r=o.split(/(?:\/|-| |:|\\)+/);if(n.length!==r.length)throw"Date ("+e+") does not fit the pattern ("+o+")";t.setHours(0,0,0,0);for(let e=0;e<r.length;e++)switch(r[e]){case"DD":NKDate.setDay(t,n[e]);break;case"MM":NKDate.setMonth(t,n[e]);break;case"YYYY":case"YY":NKDate.setYear(t,n[e]);break;case"hh":NKDate.setHour(t,n[e]);break;case"mm":NKDate.setMinute(t,n[e]);break;case"sss":NKDate.setMilisecond(t,n[e]);break;case"ss":NKDate.setSecond(t,n[e])}return t},getString:function(e,t="DD/MM/YYYY"){let o=t;return o=(o=(o=(o=(o=(o=(o=(o=o.replaceAll("DD",NKDate.getDay(e,!0))).replaceAll("MM",NKDate.getMonth(e,!0))).replaceAll("YYYY",NKDate.getYear(e,!0))).replaceAll("YY",NKDate.getYear(e,!1))).replaceAll("hh",NKDate.getHour(e,!0))).replaceAll("mm",NKDate.getMinute(e,!0))).replaceAll("sss",NKDate.getMillisecond(e,!0))).replaceAll("ss",NKDate.getSecond(e,!0))},getDay:function(e,t=!0){let o=e.getDate();return o=t?o.toString().padStart(2,"0"):o},setDay:function(e,t){if(null!==t)return e.setDate(t),e},getMonth:function(e,t=!0){let o=e.getMonth()+1;return o=t?o.toString().padStart(2,"0"):o},setMonth:function(e,t){if(null!==t)return e.setMonth(parseInt(t)-1),e},getYear:function(e,t=!0){if(t)return e.getFullYear();let o=e.getYear();return 100<o&&(o-=100),o},setYear:function(e,t){if(null!==t)return parseInt(t)<100&&(t="20"+t),e.setFullYear(t),e},getHour:function(e,t=!0){let o=e.getHours();return o=t?o.toString().padStart(2,"0"):o},setHour:function(e,t){if(null!==t)return e.setHours(t),e},getMinute:function(e,t=!0){let o=e.getMinutes();return o=t?o.toString().padStart(2,"0"):o},setMinute:function(e,t){if(null!==t)return e.setMinutes(t),e},getSecond:function(e,t=!0){let o=e.getSeconds();return o=t?o.toString().padStart(2,"0"):o},setSecond:function(e,t){if(null!==t)return e.setSeconds(t),e},getMillisecond:function(e,t=!0){let o=e.getMilliseconds();return o=t?o.toString().padStart(3,"0"):o},setMilisecond:function(e,t){if(null!==t)return e.setMilliseconds(t),e},getUnixTimestamp:function(e){return e.getTime()},addMonths:function(e,t){return e.setMonth(e.getMonth()+t),e},addHours:function(e,t){return NKDate.addMiliseconds(e,60*t*6e4)},addMinutes:function(e,t){return NKDate.addMiliseconds(e,60*t*1e3)},addSeconds:function(e,t){return NKDate.addMiliseconds(e,1e3*t)},addMiliseconds:function(e,t){return e.setTime(e.getTime()+t),e},print:function(e){console.log(e.toLocaleString())},equals:function(e,t,o=!0){return o?e.getTime()===t.getTime():e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},daysInMonth:function(e,t){if(0===t)throw"Month 0 does not exist, January is month 1.";return 32-new Date(e,t-1,32).getDate()},firstDayOfMonth:function(e,t,o=!1){if(0===t)throw"Month 0 does not exist, January is month 1.";e=new Date(e,t-1).getDay();return o?e:0===e?6:e-1},getDatesBetween:function(e,t=null){null===t&&(t=e);for(var o=[],n=new Date(e);n<=t;)o.push(new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)),n.setDate(n.getDate()+1);return o},getCalendar:function(t,o,e=!0,n=!1){var r=[],i=new Date,s=t===i.getFullYear()&&o===i.getMonth()+1;if(e){var a=NKDate.firstDayOfMonth(t,o,n);for(let e=0;e<a;e++)r.push({day:"",today:!1,date:null})}var l=NKDate.daysInMonth(t,o);for(let e=0;e<l;e++)r.push({day:e+1,today:s&&e+1===i.getDate(),date:new Date(t,o-1,e+1)});return r},setCalendarTasks:function(t,o,n,r,i,s){for(let e=0;e<o.length;e++){var a=o[e],l="0000-00-00 00:00:00"===a[i]?null:new Date(a[i].replace(/-/g,"/")).getTime(),c="0000-00-00 00:00:00"===a[s]?null:new Date(a[s].replace(/-/g,"/")).getTime();for(let e=0;e<t.length;e++){var u,d,N=t[e];null!==N[n]&&(d=(u=N[n].getTime())+86399999,null===c&&u<=l&&l<=d&&N[r].push(NKObject.clone(a)),null===l?console.error("Task with date_end without date_start"):u<=c&&l<=d&&N[r].push(NKObject.clone(a)))}}}},NKDrag=(NKDomTemplate={},NKDom={},NKDomTemplate.register=function(e,t){void 0!==customElements.get(e)?console.error("Error, "+e+" is already registered."):customElements.define(e,class extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=t}})},NKDomTemplate.start=function(){var t=document.querySelectorAll("template");for(let e=0;e<t.length;e++)NKDomTemplate.register(t[e].attributes.name.value,t[e].innerHTML)},NKDomTemplate.fill=function(t,e){var o=Array.isArray(e)?e:[e];let n="";for(let e=0;e<o.length;e++){n+="<"+t+">";for(var[r,i]of Object.entries(o[e]))n+='<span slot="'+r+'">'+i+"</span>";n+="</"+t+">"}return n},NKDom.parseIdOrClass=function(e){var t={is_class:!1,is_id:!1,name:""};return 0!==e.length&&(t.is_id="#"===e[0],t.is_class="."===e[0],t.name=e.slice(1)),t},NKDom.select=function(e){var t=document.querySelectorAll(e);return"#"===e[0]?t[0]:t},NKDom.getElementList=function(e){return(e="string"==typeof e?NKDom.select(e):e)instanceof NodeList?e:e instanceof Node?[e]:[]},NKDom.getElement=function(e){return(e="string"==typeof e?NKDom.select(e):e)instanceof NodeList&&0<e.length?e[0]:e instanceof Node?e:void 0},NKDom.getChildren=function(e,o=""){let n=[];o=o.toLowerCase(),NKDom.getElementList(e).forEach(function(t,e){for(let e=0;e<t.children.length;e++)""!==o&&t.children[e].tagName.toLowerCase()!==o||n.push(t.children[e])});var e=document.createDocumentFragment().childNodes,r=Object.create(e,{length:{value:n.length,enumerable:!1},item:{value:function(e){return this[+e||0]},enumerable:!1}});return n.forEach((e,t)=>r[t]=e),r},NKDom.getClosest=function(e,t){if(e=NKDom.getElement(e),(t=NKDom.parseIdOrClass(t)).is_class)for(;e&&!e.classList.contains(t.name);)e=e.parentNode;else if(t.is_id)for(;e&&e.id!==t.name;)e=e.parentNode;return e},NKDom.setCss=function(e,t,o){let n=t.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()});NKDom.getElementList(e).forEach(function(e,t){e.style[n]=o})},NKDom.getCss=function(e,t){let o=t.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}),n=[];if(NKDom.getElementList(e).forEach(function(e,t){n.push(window.getComputedStyle(e)[o])}),0!==n.length)return 1===n.length?n[0]:n},NKDom.setAttribute=function(e,o,n){NKDom.getElementList(e).forEach(function(e,t){e.setAttribute(o,n)})},NKDom.getAttribute=function(e,t){if(0!==(e=NKDom.getElementList(e)).length)return e[0].getAttribute(t)},NKDom.addClass=function(e,o){NKDom.getElementList(e).forEach(function(e,t){e.classList.add(o)})},NKDom.removeClass=function(e,o){NKDom.getElementList(e).forEach(function(e,t){e.classList.remove(o)})},NKDom.hasClass=function(e,t){for(var o=NKDom.getElementList(e),n=0;n<o.length;n++)if(o[n].classList.contains(t))return!0;return!1},NKDom.setHtml=function(e,o){NKDom.getElementList(e).forEach(function(e,t){e.innerHTML=o})},NKDom.appendHtml=function(e,o){NKDom.getElementList(element).forEach(function(e,t){e.insertAdjacentHTML("afterend",o)})},NKDom.addEventListener=function(e,o,n,r=!0){NKDom.getElementList(e).forEach(function(e,t){r&&e.removeEventListener(o,n),e.addEventListener(o,n)})},{}),nkdrag_event_listener=new NKEventListener;NKDrag={...nkdrag_event_listener,selection:{element:null}},NKDrag.start=function(e){if(!NK.isset(NKDrag.loaded)||!0!==NKDrag.loaded){if(NKDrag.loaded=!0,void 0===NKPosition)throw"You must include NKPosition.js";NKPosition.start(),window.addEventListener("load",NKDrag.reload),!0===window.loaded&&NKDrag.reload(),!0===e&&NK.core.reloadOnDomChange(NKDrag),NKDom.addEventListener(document,"mousemove",function(e){var t,o;null!=NKDrag.selection.element&&(t=NKPosition.getMouseX()-NKDrag.selection.offset[0],o=NKPosition.getMouseY()-NKDrag.selection.offset[1],NKDrag.selection.element.style.left=t+"px",NKDrag.selection.element.style.top=o+"px",NKDrag.dispatchEvent("onDrag",{e:NKDrag.selection.element,position:{left:t,top:o}}))})}},NKDrag.reload=function(){NKDom.addEventListener(".NKDrag_src","mousedown",function(e){NKDrag.selection.element=NKDom.getClosest(this,".NKDrag_dst"),NKDrag.selection.offset=NKPosition.getMouse(),NKDrag.selection.offset[0]-=NKDrag.selection.element.offsetLeft,NKDrag.selection.offset[1]-=NKDrag.selection.element.offsetTop}),NKDom.addEventListener(".NKDrag_src","mouseup",function(e){NKDrag.selection.element=null})};var NKForm={};if(void 0===NK)throw"You must include base.js before form.js";NKForm.errors={duplicated_fields:!0,invalid_json:!0},NKForm.getFields=function(e,t){var o={};return $(e+" :input").each(function(){if(!NK.empty(this.name))if("[]"===this.name.slice(-2)){var e=this.name.substr(0,this.name.length-2);NK.isset(o[e])||(o[e]=[]),o[e].push($(this).val())}else{if(NKForm.errors.duplicated_fields&&NK.isset(o[this.name]))throw"NKForm.getFields: Duplicated input field with name ("+this.name+")";e=$(this).attr("type");o[this.name]="checkbox"===e?$(this).prop("checked"):$(this).val()}}),!0===t?JSON.stringify(o):o},NKForm.setFields=function(e,t,o){if(!NK.empty(t)){if(!0===o)try{t=JSON.parse(t)}catch(e){if(NKForm.errors.invalid_json)throw"NKForm.setFields: Invalid input json. ("+t+")";return}$(e+" :input").each(function(){NK.empty(t[this.name])||("checkbox"===$(this).attr("type")?$(this).prop("checked",/^(true|1)$/i.test(t[this.name])):$(this).val(t[this.name]))})}},NKForm.clearFields=function(e){$(e+" :input").each(function(){"checkbox"===$(this).attr("type")?$(this).prop("checked",!1):$(this).val("")})},NKForm.send=function(e,t,o){$.post(t,NKForm.getFields(e),function(e,t){NK.isset(o)?o(e,t):location.reload()})},NKForm.fileChooser=function(o,e,t=!1,n=!0){e=e||"",t=t?"multiple":"",$("body").append('<input type="file" id="NKtmpfile" accept="'+e+'" '+t+">");e=document.getElementById("NKtmpfile");e.addEventListener("change",async function(e){var t=await NKForm._cleanFileList(this.files,n);o(t)},!1),$("#NKtmpfile").trigger("click"),e.parentNode.removeChild(e)},NKForm.dirChooser=function(e,t){window.showDirectoryPicker({startIn:e}).then(e=>{t(e)})},NKForm.postFile=function(e,t,o,n){var r,i=new FormData;for(r in i.append("file[]",t),o)i.append(r,o[r]);$.ajax({type:"POST",url:e,contentType:!1,processData:!1,data:i,success:function(e){n(e)}})},NKForm.fileDropzone=function(e,t,o=!0){e.addEventListener("drop",async function(e){e.preventDefault();e=e.dataTransfer.files,0===e.length&&console.error("Unable to handle dragged files."),e=await NKForm._cleanFileList(e,o);t(e)}),e.addEventListener("dragover",function(e){e.preventDefault()})},NKForm._cleanFileList=async function(e,t=!0){for(var o=[],n=0;n<e.length;n++){var r=e[n],i={file_obj:r,name:r.name,size:r.size,type:r.type,lastModifiedDate:r.lastModifiedDate,lastModified:r.lastModified};t&&(i.base64=await NKForm.getFileBase64(r)),o.push(i)}return o},NKForm.getFileBase64=function(n){return new Promise(function(t,o){var e=new FileReader;e.onload=function(e){t(this.result)},e.onerror=function(e){o()},e.readAsDataURL(n)})};let NKLoader={};if(void 0===NK)throw"You must include NKBase.js before loader.js";NKLoader.setSelector=function(e,n){NKDom.setCss(e,"display","none"),NKDom.setCss(n,"display","none"),window.setInterval(function(){0<$.active?NKDom.setCss(e,"display","block"):($.active=0,NKDom.setCss(e,"display","none"))},500),$(document).ajaxError(function(){$.active=0}),"localhost"!=document.domain&&(window.onerror=function(e,t,o){return $.active=0,NK.isset(n)&&NKDom.setCss(n,"display","block"),console.log("Error: ",e,t,o),!0})};var NKModal={config:{add_close_icon:!0,close_on_click_outside:!0},reload:function(){$(".NKModal .NKCloseIcon").off().on("click",function(){$(this).parents(".NKModal").hide()}),NKModal.config.close_on_click_outside&&$(".NKModal").off().on("click",function(e){e.target===this&&$(this).hide()})},show:function(e){var t,o,n="#"+e;0===$(n).length?console.error("Element "+n+" not found."):(0===(t=$(".NKModal "+n)).length&&(o='<div class="NKModal '+e+'">            <div class="NKContent">                '+(NKModal.config.add_close_icon?'<i class="NKCloseIcon"></i>':"")+"            </div>        </div>",$(n).after(o),$(n).appendTo(".NKModal."+e+" .NKContent"),$(n).show(),NKModal.reload()),$(n).parents(".NKModal").show(),t.show())},hide:function(e){e="#"+e;0!==$(".NKModal "+e).length&&$(e).parents(".NKModal").hide()},toggle:function(e){0!==$(".NKModal #"+e).length&&$("#"+e).parents(".NKModal").is(":visible")?NKModal.hide(e):NKModal.show(e)}},NKNotification={timeout:null};if(void 0===NK)throw"You must include base.js before loader.js";NKNotification.start=function(){var e,t;$("#NKNotification").length<1&&(e=document.createElement("div"),t=document.createElement("div"),e.setAttribute("id","NKNotification"),e.style.display="none",e.innerHTML='<svg onclick="NKNotification.hide()" class="close-icon" xmlns="http://www.w3.org/2000/svg" stroke="black" width="20" height="20" viewBox="0 0 24 24" stroke-width="3" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',t.setAttribute("class","content_wrapper"),e.append(t),document.body.appendChild(e))},NKNotification.show=function(e=["Title","Subtitle"],t=0){clearTimeout(NKNotification.timeout),document.getElementById("NKNotification").style.display="block",$("#NKNotification .content_wrapper").html("");for(var o,n=0;n<e.length;n++)"string"==typeof e[n]?((o=document.createElement("div")).setAttribute("class","content"),0===n&&o.setAttribute("class","content bold"),o.innerHTML=e[n],$("#NKNotification .content_wrapper").append(o)):$("#NKNotification .content_wrapper").append(e[n]);0<t&&(NKNotification.timeout=setTimeout(NKNotification.hide,t))},NKNotification.hide=function(){clearTimeout(NKNotification.timeout),document.getElementById("NKNotification").style.display="none"};let NKObject={clone:function(e){return JSON.parse(JSON.stringify(e))},setValue:function(start_obj,str_obj_path,value){let path_parts=str_obj_path.split("."),aux_path="start_obj";for(let i=0;i<path_parts.length;i++)aux_path+="."+path_parts[i],"undefined"===eval("typeof "+aux_path)&&eval(aux_path+" = {}");eval(aux_path+" = "+JSON.stringify(value))},getValue:function(e,t=void 0){if(void 0===e)return t;if(null==e)return t;if("function"==typeof e)try{return e()}catch(e){return t}return e}};var NKPopup={};if(void 0===NK)throw"You must include base.js before popup.js";NKPopup.config={allow_hover:!0,mouse_margin:5,box_margin:5},NKPopup.start=function(e){if(!NK.isset(NKPopup.loaded)||!0!==NKPopup.loaded){if(NKPopup.loaded=!0,void 0===NKPosition)throw"You must include position.js";NKPosition.start(),window.addEventListener("load",NKPopup.reload),!0===window.loaded&&NKPopup.reload(),!0===e&&NK.core.reloadOnDomChange(NKPopup)}},NKPopup.reload=function(){$(".NKPopup_dst").hide(),$(".NKPopup_src").off(),$(".NKPopup_src").on("mousemove",function(){var e=$(this).siblings(".NKPopup_dst"),t=NK.isset(e.attr("nk-type"))?e.attr("nk-type"):"box",o=NK.isset(e.attr("nk-align"))?e.attr("nk-align").split(","):["top","center"],n=NK.isset(e.attr("nk-offset"))?e.attr("nk-offset").split(",").map(Number):[0,0],r=NK.isset(e.attr("nk-arrow-size"))?e.attr("nk-arrow-size").split(",").map(Number)[1]:0,i=e.attr("nk-x"),s=e.attr("nk-y"),a=(e.show(),{});if("mouse"===t)var l=[10,22],c=NKPosition.getMouse(),u=NKPopup.config.mouse_margin;else{if("box"!==t)throw"Invalid type: "+t;l=[$(this).outerWidth(),$(this).outerHeight()],c=[$(this).offset().left,$(this).offset().top],u=NKPopup.config.box_margin}if("top"===o[0]||"bottom"===o[0]){if(NK.isset(o[1])&&"center"!==o[1])if("left"===o[1])a={left:c[0]-e.outerWidth()+l[0],top:c[1]-e.outerHeight()-r-u};else{if("right"!==o[1])throw"Invalid param '"+o[1]+"'";a={left:c[0],top:c[1]-e.outerHeight()-r-u}}else a={left:c[0]-e.outerWidth()/2+l[0]/2,top:c[1]-e.outerHeight()-r-u};"bottom"===o[0]&&(a.top+=l[1]+e.outerHeight()+2*r+2*u)}else{if("left"!==o[0]&&"right"!==o[0])throw"Invalid param '"+o[0]+"'";if(NK.isset(o[1])&&"middle"!==o[1])if("top"===o[1])a={left:c[0]-e.outerWidth()-u-r,top:c[1]-e.outerHeight()+l[1]};else{if("bottom"!==o[1])throw"Invalid param '"+o[1]+"'";a={left:c[0]-e.outerWidth()-u-r,top:c[1]}}else a={left:c[0]-e.outerWidth()-u-r,top:c[1]-e.outerHeight()/2+l[1]/2};"right"===o[0]&&(a.left+=l[0]+e.outerWidth()+2*r+2*u)}a.left=a.left+n[0],a.top=a.top+n[1],NK.isset(i)&&(a.left=i),NK.isset(s)&&(a.top=s),e.offset(a)}),$(".NKPopup_src").on("mouseleave",function(){var e=$(this);NKPopup.config.allow_hover?window.setTimeout(function(){0==e.siblings(".NKPopup_dst:hover").length?e.siblings(".NKPopup_dst").hide():e.siblings(".NKPopup_dst:hover").on("mouseleave",function(){$(this).off().hide()})},50):e.siblings(".NKPopup_dst").hide()}),NK.core.ignoreMutations(1),$(".NKPopup_dst").each(function(e){var t,o,n,r,i,s,a;(NK.isset($(this).attr("nk-arrow-size"))||NK.isset($(this).attr("nk-arrow-offset")))&&(t=NK.isset($(this).attr("nk-arrow-size"))?$(this).attr("nk-arrow-size").split(",").map(Number):[10,7],o=NK.isset($(this).attr("nk-offset"))?$(this).attr("nk-offset").split(",").map(Number):[0,0],n=NK.isset($(this).attr("nk-align"))?$(this).attr("nk-align").split(","):["top","center"],r=$(this).siblings(".NKPopup_src"),(i=$(document.createElement("i"))).addClass("NKPopup_arrow_stroke"),$(this).append(i),(s=$(document.createElement("i"))).addClass("NKPopup_arrow_fill"),$(this).append(s),a={border:1,stroke_border:[0,0,0,0],fill_border:[0,0,0,0],stroke_colors:["","","",""],fill_colors:["","","",""],left:[50,50],top:[0,0]},"top"===n[0]?(a.border=parseInt($(this).css("border-bottom-width").split("px")[0]),a.stroke_border=[t[1]+a.border,t[0]/2+a.border,0,t[0]/2+a.border],a.fill_border=[t[1],t[0]/2,0,t[0]/2],a.top=[$(this).innerHeight(),$(this).innerHeight()],a.stroke_colors[0]=$(this).css("border-bottom-color"),a.fill_colors[0]=$(this).css("background-color")):"bottom"===n[0]?(a.border=parseInt($(this).css("border-top-width").split("px")[0]),a.stroke_border=[0,t[0]/2+a.border,t[1]+a.border,t[0]/2+a.border],a.fill_border=[0,t[0]/2,t[1],t[0]/2],a.top=[-1*t[1]-1,-1*t[1]],a.stroke_colors[2]=$(this).css("border-top-color"),a.fill_colors[2]=$(this).css("background-color")):"right"===n[0]?(a.border=parseInt($(this).css("border-left-width").split("px")[0]),a.stroke_border=[t[0]/2+a.border,t[1]+a.border,t[0]/2+a.border,0],a.fill_border=[t[0]/2,t[1],t[0]/2,0],a.stroke_colors[1]=$(this).css("border-left-color"),a.fill_colors[1]=$(this).css("background-color"),a.left[0]=0-t[1]-a.border,a.left[1]=a.left[0]+a.border):"left"===n[0]&&(a.border=parseInt($(this).css("border-right-width").split("px")[0]),a.stroke_border=[t[0]/2+a.border,0,t[0]/2+a.border,t[1]+a.border],a.fill_border=[t[0]/2,0,t[0]/2,t[1]],a.stroke_colors[3]=$(this).css("border-right-color"),a.fill_colors[3]=$(this).css("background-color"),a.left[0]=$(this).innerWidth(),a.left[1]=a.left[0]),"left"===n[1]?(a.left[0]=$(this).outerWidth()-r.outerWidth()/2-t[0]/2-2*a.border,a.left[1]=a.left[0]+a.border):"center"===n[1]?(a.left[0]=$(this).outerWidth()/2-t[0]/2-2*a.border,a.left[1]=a.left[0]+a.border):"right"===n[1]?(a.left[0]=r.outerWidth()/2-t[0]/2-2*a.border,a.left[1]=a.left[0]+a.border):"top"===n[1]?(a.top[0]=$(this).outerHeight()-r.outerHeight()/2-t[0]/2-a.border,a.top[1]=a.top[0]+a.border):"middle"===n[1]?(a.top[0]=$(this).outerHeight()/2-t[0]/2-a.border,a.top[1]=a.top[0]+a.border):"bottom"===n[1]&&(a.top[0]=r.outerHeight()/2-t[0]/2-a.border,a.top[1]=a.top[0]+a.border),a.left[0]-=o[0],a.left[1]-=o[0],a.top[0]-=o[1],a.top[1]-=o[1],i.css("top",a.top[0]).css("left",a.left[0]).css("border-top-width",a.stroke_border[0]).css("border-right-width",a.stroke_border[1]).css("border-bottom-width",a.stroke_border[2]).css("border-left-width",a.stroke_border[3]).css("border-top-color",a.stroke_colors[0]).css("border-right-color",a.stroke_colors[1]).css("border-bottom-color",a.stroke_colors[2]).css("border-left-color",a.stroke_colors[3]),s.css("top",a.top[1]).css("left",a.left[1]).css("border-top-width",a.fill_border[0]).css("border-right-width",a.fill_border[1]).css("border-bottom-width",a.fill_border[2]).css("border-left-width",a.fill_border[3]).css("border-top-color",a.fill_colors[0]).css("border-right-color",a.fill_colors[1]).css("border-bottom-color",a.fill_colors[2]).css("border-left-color",a.fill_colors[3]))})};var NKPosition={};if(void 0===NK)throw"You must include base.js before position.js";NKPosition.start=function(){NK.isset(NKPosition.loaded)&&!0===NKPosition.loaded||(NKPosition.loaded=!0,NKPosition.mouse=[0,0],window.addEventListener("mousemove",function(e){NKPosition.mouse=[e.clientX,e.clientY]},!0))},NKPosition.getMouse=function(e){return!0===(e=e||!1)?NKPosition.mouse:[NKPosition.mouse[0]+window.scrollX,NKPosition.mouse[1]+window.scrollY]},NKPosition.getMouseX=function(e){return!0===(e=e||!1)?NKPosition.mouse[0]:NKPosition.mouse[0]+window.scrollX},NKPosition.getMouseY=function(e){return!0===(e=e||!1)?NKPosition.mouse[1]:NKPosition.mouse[1]+window.scrollY},NKPosition.getScroll=function(){return[window.scrollX,window.scrollY]},NKPosition.getScrollX=function(){return window.scrollX},NKPosition.getScrollY=function(){return window.scrollY};class NKPromise{constructor(){let o=null,n=null;var e=new Promise((e,t)=>{o=e,n=t});return e.resolve=o,e.reject=n,e}}let NKResize={};if(void 0===NK)throw"You must include base.js before context_menu.js";let nkresize_event_listener=new NKEventListener;NKResize={...nkresize_event_listener,config:{column_resize_cursor:"col-resize",row_resize_cursor:"row-resize"},start:function(e){if(!0!==NKResize.loaded){if(NKResize.loaded=!0,"undefined"==typeof NKDom)throw"You must include NKDom.js";if(void 0===NKPosition)throw"You must include NKPosition.js";NKPosition.start(),window.addEventListener("load",NKResize.reload),!0===window.loaded&&NKResize.reload(),!0===e&&NK.core.reloadOnDomChange(NKResize)}},reload:function(){var e=NKDom.select(".NKResize_columns"),t=NKDom.select(".NKResize_rows");function c(e,t,o,n){let r=[];var i=[],s=parseInt(NKDom.getAttribute(t,"nk-i"));if(s===(r=(n?NKDom.getCss(e,"grid-template-columns"):NKDom.getCss(e,"grid-template-rows")).split(" ")).length-1)return r.join(" ");for(let e=0;e<r.length;e++)e===s?i.push(o+"px"):e===s+1?i.push("auto"):i.push(r[e]);return i}function o(e){var t=[this.offsetLeft,this.offsetTop],n=NKPosition.getMouse(),t=[n[0]-t[0],n[1]-t[1]],r=[this.clientWidth,this.clientHeight],o=r[0]-5<=t[0],t=r[1]-5<=t[1],i=this===this.parentNode.lastElementChild,e=e.type;if("mousedown"===e)o&&!i&&(NKResize.resizing_vertical_element=this,NKResize.start_columns=NKDom.getCss(this.parentNode,"grid-template-columns").split(" "),NKResize.start_pos=n,NKResize.start_size=r,NKDom.addClass(NKDom.getChildren(NKDom.getChildren(".NKResize_columns","div")),"NKResize_disable_temp")),t&&!i&&(NKResize.resizing_horizontal_element=this,NKResize.start_rows=NKDom.getCss(this.parentNode,"grid-template-rows").split(" "),NKResize.start_pos=n,NKResize.start_size=r,NKDom.addClass(NKDom.getChildren(NKDom.getChildren(".NKResize_rows","div")),"NKResize_disable_temp"));else if("mousemove"===e){var r=NKResize.resizing_vertical_element,s=NKResize.resizing_horizontal_element;if(null!==r){var a=r.parentNode,l=parseInt(NKDom.getCss(r,"border-right-width"));let o=c(a,r,NKResize.start_size[0]+(n[0]-NKResize.start_pos[0])+l,!0);NKDom.setCss(a,"grid-template-columns",o.join(" ")),NKDom.getChildren(a,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-width",o[t])}),NKDom.setCss(this,"cursor",NKResize.config.column_resize_cursor)}else if(null!==s){var r=s.parentNode,l=parseInt(NKDom.getCss(s,"border-bottom-width"));let o=c(r,s,NKResize.start_size[1]+(n[1]-NKResize.start_pos[1])+l,!1);NKDom.setCss(r,"grid-template-rows",o.join(" ")),NKDom.getChildren(r,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-height",o[t])}),NKDom.setCss(this,"cursor",NKResize.config.row_resize_cursor)}else o&&!i&&NKDom.hasClass(this.parentNode,"NKResize_columns")?NKDom.setCss(this,"cursor",NKResize.config.column_resize_cursor):t&&!i&&NKDom.hasClass(this.parentNode,"NKResize_rows")?NKDom.setCss(this,"cursor",NKResize.config.row_resize_cursor):NKDom.setCss(this,"cursor","")}else"mouseup"===e&&(a=NKResize.resizing_vertical_element,s=NKResize.resizing_horizontal_element,null!==a&&(n=NKDom.getCss(a.parentNode,"grid-template-columns").split(" "),l=parseInt(NKDom.getAttribute(a,"nk-i")),NKResize.dispatchEvent("onResize",{start:NKResize.start_columns,end:n,i:l,e:a,parent:a.parentNode}),NKDom.removeClass(NKDom.getChildren(NKDom.getChildren(".NKResize_columns","div")),"NKResize_disable_temp")),null!==s&&(r=NKDom.getCss(s.parentNode,"grid-template-rows").split(" "),o=parseInt(NKDom.getAttribute(s,"nk-i")),NKResize.dispatchEvent("onResize",{start:NKResize.start_rows,end:r,i:o,e:s,parent:s.parentNode}),NKDom.removeClass(NKDom.getChildren(NKDom.getChildren(".NKResize_rows","div")),"NKResize_disable_temp")),NKResize.resizing_vertical_element=null,NKResize.resizing_horizontal_element=null,NKDom.setCss(this,"cursor",""))}e.forEach(function(e,t){let o=[];NKDom.getChildren(e,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-i",t),NKDom.setCss(e,"overflow","hidden");t=NKDom.getAttribute(e,"nk-width"),t=NK.empty(t)?"auto":t;o.push(t)}),NKDom.setCss(e,"display","grid"),NKDom.setCss(e,"grid-template-columns",o.join(" ")),NKDom.setCss(e,"overflow","hidden")}),t.forEach(function(e,t){let o=[];NKDom.getChildren(e,"div").forEach(function(e,t){NKDom.setAttribute(e,"nk-i",t),NKDom.setCss(e,"overflow","hidden");t=NKDom.getAttribute(e,"nk-height"),t=NK.empty(t)?"auto":t;o.push(t)}),NKDom.setCss(e,"display","grid"),NKDom.setCss(e,"grid-template-rows",o.join(" ")),NKDom.setCss(e,"overflow","hidden")}),NKResize.resizing_vertical_element=null,NKResize.resizing_horizontal_element=null,NKDom.addEventListener(".NKResize_columns","mouseleave",function(){NKResize.resizing_vertical_element=null,NKDom.setCss(this,"cursor","")}),NKDom.addEventListener(".NKResize_rows","mouseleave",function(){NKResize.resizing_horizontal_element=null,NKDom.setCss(this,"cursor","")}),NKDom.addEventListener(NKDom.getChildren(".NKResize_columns","div"),"mousemove",o),NKDom.addEventListener(NKDom.getChildren(".NKResize_columns","div"),"mousedown",o),NKDom.addEventListener(NKDom.getChildren(".NKResize_columns","div"),"mouseup",o),NKDom.addEventListener(NKDom.getChildren(".NKResize_rows","div"),"mousemove",o),NKDom.addEventListener(NKDom.getChildren(".NKResize_rows","div"),"mousedown",o),NKDom.addEventListener(NKDom.getChildren(".NKResize_rows","div"),"mouseup",o)}};var NKRouting={routes:[],get_url:function(){return[window.location.protocol+"//",window.location.host,window.location.pathname.split("/").slice(0,-1).join("/")+"/",window.location.pathname.split("/").pop(),window.location.search]},set_routes:function(e){NKRouting.routes[e.router_name]=e,NK.isset(e.default_section)&&$(document).ready(function(){NKRouting.go(e.router_name,e.default_section)})},go:function(e,t){var o;NK.isset(NKRouting.routes[e])?(o=NKRouting.routes[e].sections[t],NK.isset(o)?NK.isset(o.get)?NKRouting._perform_get(e,t):NK.isset(o.show)&&NKRouting._perform_show(e,t):console.error("Routes for",e,"->",t,"not set.")):console.error("Routes for",e,"not set.")},_perform_show:function(e,t){var o=NKRouting.routes[e].container,n=NKRouting.routes[e].sections;if(NK.isset(o)){if(!NK.isset(n[t].content))for(var r in n)n[r].content=$(n[r].show).html(),$(n[r].show).html("");NKRouting._replace_content(e,t)}else{for(var r in n)$(n[r].show).hide();$(n[t].show).show()}NKRouting._run_controller(e,t)},_perform_get:function(t,o){var n=NKRouting.routes[t].sections[o];NK.isset(n.loading)||(NK.isset(n.content)?(NKRouting._replace_content(t,o),NKRouting._run_controller(t,o)):(n.loading=!0,$.ajax({url:n.get,success:function(e){n.content=e,NKRouting._replace_content(t,o),delete n.loading,NKRouting._run_controller(t,o)}})))},_replace_content:function(e,t){var o=NKRouting.routes[e].container,n=NKRouting.routes[e].sections[t].content;NKRouting.routes[e].sections[t].ctrl;$(o).html(n)},_run_controller:function(router_name,section){var router=NKRouting.routes[router_name],ruta=NKRouting.routes[router_name].sections[section],controller_init=ruta.ctrl+".init",controller_enter=ruta.ctrl+".enter",last_controller,first_time;NK.isset(router.last_section)&&(last_controller=NKRouting.routes[router_name].sections[router.last_section].ctrl,NK.isset(last_controller))&&"function"===eval("typeof "+last_controller+".leave")&&eval(last_controller+".leave()"),router.last_section=section,NK.isset(ruta.ctrl)&&(first_time=!NK.isset(ruta.loaded),ruta.loaded=!0,first_time&&"function"===eval("typeof "+controller_init)&&eval(controller_init+"()"),"function"===eval("typeof "+controller_enter))&&eval(controller_enter+"()")}};let NKStick={};if(void 0===NK)throw"You must include base.js before stick.js";NKStick.start=function(){NK.isset(NKStick.loaded)&&!0===NKStick.loaded||(NKDom.select(".NKStickBD").forEach(function(e,t){NKDom.setAttribute(e,"nkdata-top",e.offsetTop)}),window.addEventListener("load",NKStick.reload),window.addEventListener("resize",NKStick.reload),window.addEventListener("scroll",NKStick.reload),NKStick.loaded=!0)},NKStick.reload=function(){var e=document.documentElement.scrollHeight>window.innerHeight;let n=document.documentElement.scrollTop;e?NKDom.removeClass(".NKStickBN","NKStickBO"):NKDom.addClass(".NKStickBN","NKStickBO"),e&&(NKDom.removeClass(".NKStickBD","NKStickBO"),NKDom.select(".NKStickBD").forEach(function(e,t){n+window.innerHeight<e.offsetTop+e.clientHeight&&NKDom.addClass(".NKStickBD","NKStickBO")}),NKDom.removeClass(".NKStickTD","NKStickTO"),NKDom.select(".NKStickTD").forEach(function(e,t){var o;"fixed"===NKDom.getCss(e,"position")?(o=parseInt(NKDom.getCss(e,"top")),n<o?NKDom.setCss(e,"margin-top",-n):NKDom.setCss(e,"margin-top",-o)):n>e.offsetTop&&NKDom.addClass(".NKStickTD","NKStickTO")}))};var NKStorage={};if(void 0===NK)throw"You must include base.js before storage.js";var nkstorage_event_listener=new NKEventListener,NKStorage={...nkstorage_event_listener,p:null,np:null,save:function(e){!0===e||NKStorage.is_safari?(localStorage.setItem("NKStorage",JSON.stringify(NKStorage.p)),sessionStorage.setItem("NKStorage",JSON.stringify(NKStorage.np)),NKStorage.saveOnLeave=!1):NKStorage.saveOnLeave=!0},start:function(e=!0){if(NKStorage.saveOnLeave=e,!NK.isset(NKStorage.loaded)||!0!==NKStorage.loaded){NKStorage.is_safari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);try{NKStorage.p=JSON.parse(localStorage.getItem("NKStorage"))}catch(e){}NK.isset(NKStorage.p)||(localStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.p=JSON.parse("{}"));try{NKStorage.np=JSON.parse(sessionStorage.getItem("NKStorage"))}catch(e){}NK.isset(NKStorage.np)||(sessionStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.np=JSON.parse("{}")),NKStorage.loaded=!0}},clear:function(){localStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.p=JSON.parse("{}"),sessionStorage.setItem("NKStorage",JSON.stringify({})),NKStorage.np=JSON.parse("{}")},broadcast:function(e){var t,o=e.split("."),n=[];for(t in o)n.push(o[t]),NKStorage.dispatchEvent(n.join("."))},listen:function(e,t){NKStorage.addEventListener(e,t)}};NKStorage.oldLeaveHandler=window.onbeforeunload,window.onbeforeunload=function(e){NKStorage.oldLeaveHandler&&NKStorage.oldLeaveHandler(e),!0===NKStorage.saveOnLeave&&NKStorage.save(!0)};let NKVar={isset:function(e){if(void 0===e)return!1;if(null==e)return!1;if("function"==typeof e)try{e()}catch(e){return!1}return!0},empty:function(e){return!NK.isset(e)||0===(e="function"==typeof e?e():e).length}};var NKWebsocketClient=function(e,t){this.host=e,this.port=t,this.socket=null,this.writePromises={},this.connect=function(){let r=this;this.socket=new WebSocket("ws://"+this.host+":"+this.port),this.socket.addEventListener("open",e=>this.onOpen(e)),this.socket.addEventListener("close",e=>this.onClose(e)),this.socket.addEventListener("error",e=>this.onError(e)),this.socket.addEventListener("message",e=>{let t=e.data.toString(),o=t.charCodeAt(0),n=t.charCodeAt(1);t=t.substring(2),0===o?this.onMessage(t,function(e){r.socket.send(String.fromCharCode(o)+String.fromCharCode(n)+e)},e):(this.writePromises[o](t),delete this.writePromises[o])})},this.connected=function(){return this.socket.readyState!==WebSocket.CLOSED},this.reconnect=async function(){for(;!this.connected();)this.connect(),await NK.sleep(5e3)},this.write=function(e){this.socket.send(String.fromCharCode(0)+String.fromCharCode(0)+e)},this.writeAndWait=function(e,o){let n=this,r=0;var t;for(let e=1;e<255;e++)if(void 0===this.writePromises[e]){r=e;break}return 0===r?new Promise(function(e,t){t("Error, too many writeAndWait")}):(t=new Promise(function(e,t){n.writePromises[r]=e,setTimeout(function(){t("Timeout")},o)}),this.socket.send(String.fromCharCode(r)+String.fromCharCode(0)+e),t)},this.onOpen=function(e){},this.onMessage=function(e,t,o){},this.onClose=function(e){},this.onError=function(e){}};String.prototype.escape=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;"};return this.replace(/[&<>]/g,function(e){return t[e]||e})};